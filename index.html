<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwimFuel Premium - Swimmer Nutrition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .navbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: bold;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #000000;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #1e3a8a;
            background: #eff6ff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .back-btn {
            background: #e5e7eb;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            color: #666;
            cursor: pointer;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: #d1d5db;
        }

        h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        .subtitle {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        /* Clean header style matching SwimCloud */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .see-all-link {
            color: #2563eb;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .see-all-link:hover {
            text-decoration: underline;
        }

        .swimmer-profile {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .swimmer-profile h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .profile-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .profile-group {
            display: flex;
            flex-direction: column;
        }

        .profile-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .profile-group select, .profile-group input {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .profile-group select:focus, .profile-group input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .radio-options {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: normal;
            cursor: pointer;
            margin-bottom: 0;
        }

        .radio-label input[type="radio"] {
            margin: 0;
            padding: 0;
            width: auto;
            height: auto;
        }

        .weight-section, .height-section {
            min-width: 300px;
        }

        .feet-inches-container {
            display: flex;
            gap: 1rem;
        }

        .feet-inches-container input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .feet-inches-container input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #bmiResult {
            background-color: #f9fafb;
            color: #374151;
            font-weight: 500;
        }

        .calendar-integration {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f0f9ff;
            border-radius: 4px;
            border-left: 3px solid #0ea5e9;
        }

        .calendar-integration small {
            color: #0c4a6e;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .calendar-integration a {
            color: #0284c7;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .calendar-integration a:hover {
            color: #0369a1;
            text-decoration: underline;
        }

        .phase-selector {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .phase-selector h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .phase-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .phase-btn {
            padding: 1rem 1.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-align: center;
            line-height: 1.3;
            min-width: 140px;
        }

        .phase-btn small {
            font-size: 0.8rem;
            font-weight: 500;
            color: #666;
            display: block;
            margin-top: 0.3rem;
        }

        .phase-btn.active {
            border-color: #2563eb;
            background: #2563eb;
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .phase-btn.active small {
            color: #e0e7ff;
        }

        .phase-btn:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .nutrition-breakdown {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .nutrition-breakdown h3 {
            margin-bottom: 1.5rem;
            color: #111;
            text-align: center;
        }

        .personalized-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .personalized-header h4 {
            margin: 0;
            font-size: 1.1rem;
        }

        .macro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .macro-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .macro-card.carbs {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .macro-card.protein {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .macro-card.veggies {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .macro-card.fruits {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .macro-percent {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .macro-label {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .phase-notes {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            color: #666;
            font-style: italic;
            border-left: 4px solid #2563eb;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .filter-group select, .filter-group input {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }

        .legend {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .diet-info {
            background: #eff6ff;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #3b82f6;
        }

        .diet-info h4 {
            margin: 0 0 0.5rem 0;
            color: #1e40af;
            font-size: 1rem;
        }

        .diet-info p {
            margin: 0;
            color: #374151;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .choose { background: #10b981; }
        .limit { background: #f59e0b; }
        .avoid { background: #ef4444; }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .food-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .food-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .food-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .food-content {
            padding: 1.5rem;
        }

        .food-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #111;
        }

        .food-category {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .recommendation-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .recommendation-badge.choose {
            background: #10b981;
        }

        .recommendation-badge.limit {
            background: #f59e0b;
        }

        .recommendation-badge.avoid {
            background: #ef4444;
        }

        .diet-compatibility {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: #f3f4f6;
            border-radius: 4px;
            border-left: 3px solid #10b981;
        }

        .diet-compatibility small {
            color: #374151;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .food-benefits {
            list-style: none;
        }

        .food-benefits li {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            padding-left: 1rem;
            position: relative;
        }

        .food-benefits li::before {
            content: "•";
            color: #2563eb;
            position: absolute;
            left: 0;
        }

        .foods-to-avoid {
            margin-top: 3rem;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .foods-to-avoid h2 {
            color: #ef4444;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .avoid-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .avoid-food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .avoid-card {
            border: 2px solid #fecaca;
            background: #fef2f2;
        }

        .avoid-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.15);
            border-color: #f87171;
        }

        .avoid-image {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .avoid-effects li {
            color: #dc2626;
        }

        .avoid-effects li::before {
            content: "⚠";
            color: #ef4444;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        /* Calendar Styles */
        .calendar-header {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .current-period {
            font-size: 1.5rem;
            font-weight: bold;
            color: #111;
            min-width: 300px;
            text-align: center;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .view-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .view-btn:hover:not(.active) {
            background: #f3f4f6;
        }

        .calendar-legends {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .legend-grid {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calendar-legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .calendar-legend-color.meet { background: #3b82f6; }
        .calendar-legend-color.time-trial { background: #10b981; }
        .calendar-legend-color.championship { background: #f59e0b; }
        .calendar-legend-color.special { background: #ef4444; }
        .calendar-legend-color.practice { background: #8b5cf6; }

        .calendar-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .calendar-view {
            display: grid;
            gap: 1rem;
            padding: 1.5rem;
        }

        .calendar-view.single {
            grid-template-columns: 1fr;
        }

        .calendar-view.triple {
            grid-template-columns: repeat(3, 1fr);
        }

        .month-calendar {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
        }

        .weekday {
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            color: #666;
            border-right: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .weekday:last-child {
            border-right: none;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 80px;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.5rem;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calendar-day:hover {
            background-color: #f8f9fa;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background-color: #fafafa;
        }

        .calendar-day.today {
            background-color: #eff6ff;
            border: 2px solid #3b82f6;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event {
            background: #3b82f6;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-bottom: 0.125rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
        }

        .event.time-trial { background: #10b981; }
        .event.championship { background: #f59e0b; }
        .event.special { background: #ef4444; }
        .event.practice { background: #8b5cf6; }

        .triple .calendar-day {
            min-height: 60px;
            padding: 0.25rem;
        }

        .triple .event {
            font-size: 0.55rem;
            padding: 0.1rem 0.15rem;
            margin-bottom: 0.1rem;
        }

        .triple .day-number {
            font-size: 0.8rem;
        }

        /* Multi-day event indicators */
        .event[title*="Day 1"] {
            border-left: 3px solid rgba(255,255,255,0.8);
        }

        .event[title*="Final Day"] {
            border-right: 3px solid rgba(255,255,255,0.8);
        }

        .event[title*="Day 2"]:not([title*="Day 1"]):not([title*="Final Day"]),
        .event[title*="Day 3"]:not([title*="Final Day"]),
        .event[title*="Day 4"]:not([title*="Final Day"]),
        .event[title*="Day 5"]:not([title*="Final Day"]),
        .event[title*="Day 6"]:not([title*="Final Day"]) {
            border-left: 2px solid rgba(255,255,255,0.6);
            border-right: 2px solid rgba(255,255,255,0.6);
        }

        .event-form {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 2rem;
            border: 1px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .upcoming-events {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .upcoming-events h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .event-list {
            list-style: none;
        }

        .event-item {
            padding: 0.75rem;
            border-left: 4px solid #3b82f6;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            border-radius: 0 6px 6px 0;
        }

        .event-item.time-trial { border-left-color: #10b981; }
        .event-item.championship { border-left-color: #f59e0b; }
        .event-item.special { border-left-color: #ef4444; }
        .event-item.practice { border-left-color: #8b5cf6; }

        .event-date {
            font-weight: 600;
            color: #374151;
        }

        .event-title {
            font-weight: 500;
            margin-top: 0.25rem;
        }

        /* Performance Tracking Styles */
        .meet-selector {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .meet-dropdown select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .meet-dropdown select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .meet-results {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .results-table {
            width: 100%;
        }

        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            background: #f8f9fa;
            padding: 1rem;
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-body {
            display: flex;
            flex-direction: column;
        }

        .result-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 1rem;
            border-bottom: 1px solid #f1f3f4;
            align-items: center;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-row:hover {
            background-color: #f8f9fa;
        }

        .event-name {
            font-weight: 500;
            color: #333;
        }

        .event-details {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .result-time {
            font-weight: 600;
            color: #2563eb;
            font-size: 1rem;
        }

        .pb-badge {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .improvement {
            font-weight: 500;
        }

        .improvement.positive {
            color: #10b981;
        }

        .improvement.negative {
            color: #ef4444;
        }

        .place {
            font-weight: 500;
            color: #333;
        }

        .nutrition-correlation {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .phase-performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .phase-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #2563eb;
        }

        .phase-card h4 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1rem;
        }

        .metric {
            color: #666;
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            color: #2563eb;
            font-size: 1.1rem;
        }

        /* Debug Panel Styles */
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .debug-panel h4 {
            margin: 0 0 1rem 0;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .debug-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        #debugLog {
            background: #1f2937;
            color: #10b981;
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            min-height: 120px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: #f3f4f6;
        }

        .status-text {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status-indicator.connecting {
            background: #fef3c7;
            color: #92400e;
        }

        .status-indicator.connected {
            background: #d1fae5;
            color: #065f46;
        }

        .status-indicator.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        .status-indicator.connecting .status-dot {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected .status-dot {
            background: #10b981;
        }

        .status-indicator.error .status-dot {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .retry-button {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .retry-button:hover {
            background: #d97706;
        }

        /* Manual Entry Panel */
        .manual-entry-panel {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .manual-entry-panel h4 {
            margin: 0 0 0.5rem 0;
            color: #0c4a6e;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .manual-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .form-row {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .form-row input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .form-row input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.1);
        }

        .troubleshooting-info {
            background: #fef7cd;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .troubleshooting-info h4 {
            margin: 0 0 0.5rem 0;
            color: #92400e;
            font-size: 0.9rem;
        }

        .troubleshooting-info ul {
            margin: 0.5rem 0 0 1rem;
            color: #92400e;
            font-size: 0.85rem;
        }

        .troubleshooting-info li {
            margin-bottom: 0.25rem;
        }

        /* Connection Status Detail */
        .connection-status-detail {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .connection-status-detail h4 {
            margin: 0 0 0.5rem 0;
            color: #0c4a6e;
            font-size: 0.9rem;
        }

        #connectionSteps {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            background: white;
            border: 1px solid #e0e7ff;
            border-radius: 4px;
            padding: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .connection-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            padding: 0.25rem;
            border-radius: 3px;
        }

        .connection-step.success {
            background: #d1fae5;
            color: #065f46;
        }

        .connection-step.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .connection-step.info {
            background: #f0f9ff;
            color: #1e40af;
        }

        .connection-step.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .step-icon {
            font-size: 0.7rem;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .calendar-view.triple {
                grid-template-columns: 1fr;
            }
            
            .calendar-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .current-period {
                min-width: auto;
                text-align: left;
                font-size: 1.3rem;
            }
            
            .legend-grid {
                flex-direction: column;
                gap: 1rem;
            }
        }

        // Performance Tracking Functions
        let debugMode = false;
        let currentSwimmerId = null;
        let connectionSteps = [];

        function addConnectionStep(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const step = { message, type, timestamp };
            connectionSteps.push(step);
            
            // Also log to debug console
            debugLog(message, type);
            
            // Update connection steps display
            updateConnectionStepsDisplay();
        }

        function updateConnectionStepsDisplay() {
            const stepsContainer = document.getElementById('connectionSteps');
            if (!stepsContainer) return;
            
            const stepsHtml = connectionSteps.slice(-10).map(step => {
                const icons = {
                    success: '✅',
                    error: '❌',
                    warning: '⚠️',
                    info: 'ℹ️'
                };
                
                return `
                    <div class="connection-step ${step.type}">
                        <span class="step-icon">${icons[step.type] || 'ℹ️'}</span>
                        <span>[${step.timestamp}] ${step.message}</span>
                    </div>
                `;
            }).join('');
            
            stepsContainer.innerHTML = stepsHtml;
            stepsContainer.scrollTop = stepsContainer.scrollHeight;
        }

        function clearConnectionSteps() {
            connectionSteps = [];
            updateConnectionStepsDisplay();
        }

        function debugLog(message, type = 'info') {
            if (!debugMode) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            const typeColors = {
                info: '#10b981',
                warn: '#f59e0b', 
                error: '#ef4444',
                success: '#22c55e'
            };
            
            const coloredMessage = `[${timestamp}] ${message}`;
            logElement.innerHTML += `<span style="color: ${typeColors[type]}">${coloredMessage}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function toggleDebugMode() {
            debugMode = !debugMode;
            const debugPanel = document.getElementById('debugPanel');
            const connectionDetail = document.getElementById('connectionStatusDetail');
            
            debugPanel.style.display = debugMode ? 'block' : 'none';
            connectionDetail.style.display = debugMode ? 'block' : 'none';
            
            if (debugMode) {
                debugLog('Debug mode enabled', 'success');
                addConnectionStep('Debug mode enabled', 'success');
            } else {
                clearConnectionSteps();
            }
        }

        function testWithSampleUrl() {
            addConnectionStep('🧪 Starting system test...', 'info');
            
            // Test with a simple, known URL first
            const testUrl = 'https://httpbin.org/html';
            addConnectionStep(`Testing basic connectivity with: ${testUrl}`, 'info');
            
            // Enable debug mode for this test
            if (!debugMode) {
                toggleDebugMode();
            }
            
            testBasicConnectivity(testUrl).then(() => {
                addConnectionStep('System test completed - check logs above', 'success');
                addConnectionStep('Now try entering your SwimCloud URL', 'info');
            }).catch(error => {
                addConnectionStep(`System test failed: ${error.message}`, 'error');
            });
        }

        async function testBasicConnectivity(testUrl) {
            const corsProxies = [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?',
            ];

            addConnectionStep(`Testing ${corsProxies.length} proxy services...`, 'info');

            for (let i = 0; i < corsProxies.length; i++) {
                const proxy = corsProxies[i];
                addConnectionStep(`Testing proxy ${i + 1}: ${proxy}`, 'info');
                
                try {
                    const response = await fetch(proxy + encodeURIComponent(testUrl), {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/html',
                        }
                    });

                    if (response.ok) {
                        const text = await response.text();
                        addConnectionStep(`✅ Proxy ${i + 1} works! Got ${text.length} characters`, 'success');
                        
                        // If this proxy works, test with a SwimCloud-like URL
                        if (text.length > 100) {
                            addConnectionStep('This proxy should work for SwimCloud! 🎉', 'success');
                        }
                    } else {
                        addConnectionStep(`❌ Proxy ${i + 1} returned status: ${response.status}`, 'error');
                    }
                } catch (error) {
                    addConnectionStep(`❌ Proxy ${i + 1} failed: ${error.message}`, 'error');
                }
            }
        }

        function updateStatus(status, message) {
            const statusElement = document.getElementById('connectionStatus');
            const statusText = statusElement.querySelector('.status-text');
            
            // Remove existing status classes
            statusElement.classList.remove('connecting', 'connected', 'error');
            statusElement.classList.add(status);
            
            // Add status dot if not exists
            if (!statusElement.querySelector('.status-dot')) {
                const dot = document.createElement('span');
                dot.className = 'status-dot';
                statusElement.insertBefore(dot, statusText);
            }
            
            statusText.textContent = message;
            debugLog(`Status: ${message}`, status === 'error' ? 'error' : 'info');
        }

        async function loadSwimmerData() {
            const url = document.getElementById('swimcloudUrl').value.trim();
            
            // Clear previous steps
            clearConnectionSteps();
            
            if (!url) {
                updateStatus('', 'Not connected');
                document.getElementById('performanceContent').style.display = 'none';
                addConnectionStep('No URL provided', 'warning');
                return;
            }

            addConnectionStep(`Starting connection to: ${url}`, 'info');

            // Extract swimmer ID from URL
            const swimmerIdMatch = url.match(/swimmer\/(\d+)/);
            if (!swimmerIdMatch) {
                updateStatus('error', 'Invalid URL format');
                addConnectionStep('❌ Invalid URL format. Expected: https://www.swimcloud.com/swimmer/1234567/', 'error');
                debugLog('Invalid SwimCloud URL format. Expected: https://www.swimcloud.com/swimmer/1234567/', 'error');
                return;
            }

            currentSwimmerId = swimmerIdMatch[1];
            addConnectionStep(`✅ Found swimmer ID: ${currentSwimmerId}`, 'success');
            
            updateStatus('connecting', 'Connecting to SwimCloud...');
            addConnectionStep('🔄 Connecting to SwimCloud...', 'info');
            
            debugLog(`Attempting to fetch data for swimmer ID: ${currentSwimmerId}`, 'info');
            debugLog(`URL: ${url}`, 'info');

            try {
                await fetchSwimCloudData(url);
            } catch (error) {
                updateStatus('error', 'Connection failed');
                addConnectionStep(`❌ Connection failed: ${error.message}`, 'error');
                debugLog(`Connection error: ${error.message}`, 'error');
                
                // Provide helpful error message
                if (error.message.includes('CORS') || error.message.includes('fetch')) {
                    addConnectionStep('This is likely due to browser security restrictions (CORS)', 'warning');
                    addConnectionStep('💡 Try the "Manual Entry" option below', 'info');
                    debugLog('This error is likely due to browser security restrictions', 'warn');
                    debugLog('Try using the Manual Entry option below', 'info');
                }
                
                showRetryOption();
            }
        }

        async function fetchSwimCloudData(url) {
            // Try multiple CORS proxy services
            const corsProxies = [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?',
                'https://cors-anywhere.herokuapp.com/',
            ];

            addConnectionStep(`Trying ${corsProxies.length} proxy services...`, 'info');

            for (let i = 0; i < corsProxies.length; i++) {
                const proxy = corsProxies[i];
                addConnectionStep(`🔄 Trying proxy ${i + 1}/${corsProxies.length}: ${proxy}`, 'info');
                debugLog(`Trying proxy ${i + 1}/${corsProxies.length}: ${proxy}`, 'info');
                
                try {
                    const response = await fetch(proxy + encodeURIComponent(url), {
                        method: 'GET',
                        headers: {
                            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                        }
                    });

                    if (!response.ok) {
                        const errorMsg = `HTTP ${response.status}: ${response.statusText}`;
                        addConnectionStep(`❌ Proxy ${i + 1} failed: ${errorMsg}`, 'error');
                        throw new Error(errorMsg);
                    }

                    const html = await response.text();
                    addConnectionStep(`✅ Proxy ${i + 1} success! Got ${html.length} characters`, 'success');
                    debugLog(`Successfully fetched HTML (${html.length} characters)`, 'success');
                    
                    // Analyze page if debug mode is enabled
                    if (debugMode) {
                        analyzeSwimCloudPage(html);
                    }
                    
                    // Check if we got actual HTML content
                    if (html.length < 100 || !html.includes('<html')) {
                        addConnectionStep(`⚠️ Response doesn't look like HTML (${html.length} chars)`, 'warning');
                        debugLog(`Response doesn't look like valid HTML (${html.length} chars)`, 'warn');
                        continue;
                    }
                    
                    addConnectionStep('🔍 Parsing SwimCloud data...', 'info');
                    const swimmerData = parseSwimCloudHTML(html);
                    if (swimmerData) {
                        addConnectionStep('✅ Successfully parsed swimmer data!', 'success');
                        debugLog('Successfully parsed swimmer data', 'success');
                        displaySwimmerData(swimmerData);
                        return; // Success!
                    } else {
                        addConnectionStep('❌ Failed to parse swimmer data from HTML', 'error');
                        debugLog('Failed to parse swimmer data from HTML', 'warn');
                        continue;
                    }
                    
                } catch (error) {
                    addConnectionStep(`❌ Proxy ${i + 1} error: ${error.message}`, 'error');
                    debugLog(`Proxy ${i + 1} failed: ${error.message}`, 'warn');
                    continue;
                }
            }
            
            // If all proxies fail, try direct fetch (will likely fail due to CORS)
            addConnectionStep('⚠️ All proxies failed, trying direct fetch...', 'warning');
            debugLog('All proxies failed, trying direct fetch...', 'warn');
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const html = await response.text();
                addConnectionStep(`✅ Direct fetch worked! Got ${html.length} characters`, 'success');
                debugLog(`Direct fetch successful (${html.length} characters)`, 'success');
                
                // Analyze page if debug mode is enabled
                if (debugMode) {
                    analyzeSwimCloudPage(html);
                }
                
                const swimmerData = parseSwimCloudHTML(html);
                if (swimmerData) {
                    displaySwimmerData(swimmerData);
                    return;
                }
            } catch (error) {
                addConnectionStep(`❌ Direct fetch failed: ${error.message}`, 'error');
                debugLog(`Direct fetch failed: ${error.message}`, 'error');
            }
            
            throw new Error('Unable to fetch SwimCloud data. All connection methods failed.');
        }

        function parseSwimCloudHTML(html) {
            debugLog('Parsing SwimCloud HTML...', 'info');
            
            try {
                // Create a temporary DOM parser
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extract swimmer name - try multiple selectors
                let swimmerName = 'Unknown Swimmer';
                const nameSelectors = [
                    'h1.swimmer-name',
                    '.swimmer-info h1',
                    '.page-title',
                    'h1',
                    '.swimmer-header h1',
                    '[data-swimmer-name]'
                ];
                
                for (const selector of nameSelectors) {
                    const nameElement = doc.querySelector(selector);
                    if (nameElement && nameElement.textContent.trim()) {
                        swimmerName = nameElement.textContent.trim();
                        debugLog(`Found swimmer name with selector ${selector}: ${swimmerName}`, 'success');
                        break;
                    }
                }
                
                // Extract meets data - focus on SwimCloud's specific structure
                const meets = [];
                
                // SwimCloud typically uses these patterns for meets
                const meetSelectors = [
                    '.meet-item',
                    '.meet-result-item',
                    '.meet-card',
                    '[data-meet-id]',
                    '.meet-list .meet',
                    '.results-by-meet .meet',
                    '.meet-summary'
                ];
                
                let foundMeets = false;
                
                for (const selector of meetSelectors) {
                    const meetElements = doc.querySelectorAll(selector);
                    debugLog(`Trying selector "${selector}": found ${meetElements.length} elements`, 'info');
                    
                    if (meetElements.length > 0) {
                        meetElements.forEach((element, index) => {
                            try {
                                // Try different patterns for meet title and date
                                let meetTitle = null;
                                let meetDate = null;
                                
                                // Title selectors
                                const titleSelectors = ['.meet-title', '.meet-name', 'h3', 'h4', '.title', 'a'];
                                for (const titleSel of titleSelectors) {
                                    const titleEl = element.querySelector(titleSel);
                                    if (titleEl && titleEl.textContent.trim()) {
                                        meetTitle = titleEl.textContent.trim();
                                        break;
                                    }
                                }
                                
                                // Date selectors
                                const dateSelectors = ['.meet-date', '.date', '.meet-info .date', 'time', '.when'];
                                for (const dateSel of dateSelectors) {
                                    const dateEl = element.querySelector(dateSel);
                                    if (dateEl && dateEl.textContent.trim()) {
                                        meetDate = dateEl.textContent.trim();
                                        break;
                                    }
                                }
                                
                                // If no specific date found, look for date-like text in the element
                                if (!meetDate) {
                                    const text = element.textContent;
                                    const dateMatch = text.match(/\b\w{3}\s+\d{1,2}[,-]\s*\d{4}|\d{1,2}\/\d{1,2}\/\d{4}|\w+\s+\d{1,2}-\d{1,2},?\s+\d{4}/i);
                                    if (dateMatch) {
                                        meetDate = dateMatch[0];
                                    }
                                }
                                
                                if (meetTitle || meetDate) {
                                    const meet = {
                                        id: meets.length + 1,
                                        name: meetTitle || 'Unnamed Meet',
                                        date: meetDate || 'Date unknown',
                                        element: element,
                                        html: element.outerHTML
                                    };
                                    meets.push(meet);
                                    debugLog(`Parsed meet ${meets.length}: "${meet.name}" - ${meet.date}`, 'success');
                                    foundMeets = true;
                                }
                            } catch (error) {
                                debugLog(`Error parsing meet element ${index}: ${error.message}`, 'warn');
                            }
                        });
                        
                        if (foundMeets) break; // Found meets with this selector, no need to try others
                    }
                }
                
                // If no meets found with specific selectors, try a broader search
                if (!foundMeets) {
                    debugLog('No meets found with specific selectors, trying broader search...', 'warn');
                    
                    // Look for any links or elements that contain meet-like text
                    const allElements = doc.querySelectorAll('a, div, span, h1, h2, h3, h4, h5, h6');
                    const meetKeywords = ['championship', 'meet', 'invitational', 'classic', 'open', 'sectional', 'regional', 'state', 'national'];
                    
                    allElements.forEach((element, index) => {
                        if (meets.length >= 10) return; // Limit to 10 meets max
                        
                        const text = element.textContent.trim();
                        if (text.length > 5 && text.length < 100) {
                            const lowerText = text.toLowerCase();
                            if (meetKeywords.some(keyword => lowerText.includes(keyword))) {
                                // Check if this looks like a meet name
                                const dateMatch = text.match(/\b\w{3}\s+\d{1,2}[,-]\s*\d{4}|\d{1,2}\/\d{1,2}\/\d{4}|\w+\s+\d{1,2}-\d{1,2},?\s+\d{4}/i);
                                
                                meets.push({
                                    id: meets.length + 1,
                                    name: text,
                                    date: dateMatch ? dateMatch[0] : 'Date in text',
                                    element: element,
                                    html: element.outerHTML
                                });
                                debugLog(`Found potential meet: "${text}"`, 'info');
                            }
                        }
                    });
                }
                
                debugLog(`Total meets found: ${meets.length}`, meets.length > 0 ? 'success' : 'warn');
                
                const result = {
                    name: swimmerName,
                    meets: meets,
                    rawHtml: html.substring(0, 1000) + '...' // Store snippet for debugging
                };
                
                // Important: Return the result even if no meets found
                // The connection was successful if we got the swimmer name
                return result;
                
            } catch (error) {
                debugLog(`HTML parsing error: ${error.message}`, 'error');
                return null;
            }
        }

        function displaySwimmerData(data) {
            addConnectionStep(`📊 Processing data for: ${data.name}`, 'info');
            addConnectionStep(`Found ${data.meets.length} meets`, 'info');
            debugLog(`Displaying data for swimmer: ${data.name}`, 'info');
            debugLog(`Found ${data.meets.length} meets`, 'info');
            
            // Update swimmer name
            document.getElementById('swimmerName').value = data.name;
            
            // Update connection status - this was missing!
            if (data.name !== 'Unknown Swimmer' || data.meets.length > 0) {
                const statusMsg = `Connected - Found ${data.meets.length} meets`;
                updateStatus('connected', statusMsg);
                addConnectionStep(`🎉 ${statusMsg}`, 'success');
                debugLog('Connection status updated to connected', 'success');
            } else {
                const statusMsg = 'Connected but no data found';
                updateStatus('error', statusMsg);
                addConnectionStep(`⚠️ ${statusMsg}`, 'warning');
                debugLog('Connected but no swimmer data found', 'warn');
            }
            
            // Show performance content
            document.getElementById('performanceContent').style.display = 'block';
            
            // Load meets into dropdown
            loadMeetsData(data.meets);
            
            addConnectionStep('✅ Connection completed successfully!', 'success');
        }

        function loadMeetsData(meets) {
            const meetSelect = document.getElementById('meetSelect');
            meetSelect.innerHTML = '<option value="">Select a meet...</option>';
            
            debugLog(`Loading ${meets.length} meets into dropdown`, 'info');
            
            if (meets.length === 0) {
                debugLog('No meets found in swimmer data', 'warn');
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No meets found - try debug mode to see what was parsed';
                option.disabled = true;
                meetSelect.appendChild(option);
                
                // Show debug suggestion
                const option2 = document.createElement('option');
                option2.value = 'debug';
                option2.textContent = '🔍 Enable Debug Mode to see raw data';
                option2.disabled = true;
                meetSelect.appendChild(option2);
                return;
            }
            
            meets.forEach((meet, index) => {
                const option = document.createElement('option');
                option.value = meet.id;
                option.textContent = `${meet.name} - ${meet.date}`;
                option.dataset.meetData = JSON.stringify(meet); // Store meet data for later use
                meetSelect.appendChild(option);
                debugLog(`Added meet ${index + 1}: ${meet.name}`, 'success');
            });
            
            // Add option to view all parsed data
            const debugOption = document.createElement('option');
            debugOption.value = 'show-all-data';
            debugOption.textContent = '📊 Show All Parsed Data';
            meetSelect.appendChild(debugOption);
        }

        function showRetryOption() {
            const statusElement = document.getElementById('connectionStatus');
            
            // Remove existing retry button
            const existingButton = statusElement.querySelector('.retry-button');
            if (existingButton) {
                existingButton.remove();
            }
            
            const retryButton = document.createElement('button');
            retryButton.className = 'retry-button';
            retryButton.textContent = 'Retry';
            retryButton.onclick = loadSwimmerData;
            
            statusElement.appendChild(retryButton);
        }

        function testConnection() {
            debugLog('=== CONNECTION TEST ===', 'info');
            debugLog(`Current swimmer ID: ${currentSwimmerId}`, 'info');
            debugLog(`Debug mode: ${debugMode}`, 'info');
            debugLog(`Browser: ${navigator.userAgent}`, 'info');
            
            const url = document.getElementById('swimcloudUrl').value;
            if (url) {
                debugLog(`Testing with URL: ${url}`, 'info');
                
                // Test CORS proxies
                const corsProxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?',
                ];
                
                corsProxies.forEach((proxy, index) => {
                    const testUrl = proxy + encodeURIComponent('https://httpbin.org/json');
                    debugLog(`Testing proxy ${index + 1}: ${proxy}`, 'info');
                    
                    fetch(testUrl, { method: 'GET' })
                        .then(response => {
                            const status = response.ok ? 'ACCESSIBLE ✅' : `BLOCKED ❌ (${response.status})`;
                            debugLog(`Proxy ${index + 1}: ${status}`, response.ok ? 'success' : 'error');
                        })
                        .catch(error => {
                            debugLog(`Proxy ${index + 1}: ERROR ❌ - ${error.message}`, 'error');
                        });
                });
                
                // Test if we can reach the actual SwimCloud URL
                debugLog('Testing actual SwimCloud connection...', 'info');
                setTimeout(() => {
                    loadSwimmerData(); // Re-run the connection
                }, 2000);
                
            } else {
                debugLog('No SwimCloud URL provided', 'warn');
                debugLog('Please enter a SwimCloud profile URL first', 'warn');
            }
        }

        // Add page analysis function for debugging
        function analyzeSwimCloudPage(html) {
            debugLog('=== PAGE ANALYSIS ===', 'info');
            
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Analyze page structure
                const title = doc.querySelector('title')?.textContent || 'No title found';
                debugLog(`Page title: ${title}`, 'info');
                
                // Look for common SwimCloud elements
                const commonElements = [
                    'h1', 'h2', 'h3', '.swimmer-name', '.meet', '.result', 
                    'table', '.time', '.event', '[data-swimmer]', '[data-meet]'
                ];
                
                commonElements.forEach(selector => {
                    const elements = doc.querySelectorAll(selector);
                    if (elements.length > 0) {
                        debugLog(`Found ${elements.length} elements with selector: ${selector}`, 'info');
                        // Show first few examples
                        for (let i = 0; i < Math.min(3, elements.length); i++) {
                            const text = elements[i].textContent.trim().substring(0, 50);
                            debugLog(`  Example ${i + 1}: "${text}${text.length === 50 ? '...' : ''}"`, 'info');
                        }
                    }
                });
                
                // Check for specific SwimCloud indicators
                const swimCloudIndicators = [
                    'swimcloud', 'swimmer', 'meet', 'results', 'times'
                ];
                
                const pageText = doc.body.textContent.toLowerCase();
                swimCloudIndicators.forEach(indicator => {
                    const count = (pageText.match(new RegExp(indicator, 'g')) || []).length;
                    if (count > 0) {
                        debugLog(`Found "${indicator}" ${count} times in page`, 'success');
                    }
                });
                
            } catch (error) {
                debugLog(`Page analysis error: ${error.message}`, 'error');
            }
        }

        function showManualEntry() {
            const panel = document.getElementById('manualEntryPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            
            if (panel.style.display === 'block') {
                debugLog('Manual entry panel opened', 'info');
                showTroubleshootingInfo();
            }
        }

        function saveManualData() {
            const swimmerName = document.getElementById('manualSwimmerName').value.trim();
            const meetName = document.getElementById('manualMeetName').value.trim();
            const meetDate = document.getElementById('manualMeetDate').value.trim();
            
            if (!swimmerName) {
                alert('Please enter swimmer name');
                return;
            }
            
            debugLog(`Saving manual data: ${swimmerName}`, 'info');
            
            // Set swimmer name
            document.getElementById('swimmerName').value = swimmerName;
            updateStatus('connected', 'Manual data entered');
            
            // Show performance content
            document.getElementById('performanceContent').style.display = 'block';
            
            // Create sample meet data
            const meets = [];
            if (meetName && meetDate) {
                meets.push({
                    id: 1,
                    name: meetName,
                    date: meetDate
                });
            }
            
            // Add some default meets if none provided
            if (meets.length === 0) {
                meets.push(
                    { id: 1, name: "Sample Championship Meet", date: "Jul 15-17, 2025" },
                    { id: 2, name: "Regional Championships", date: "Jun 20-22, 2025" }
                );
            }
            
            loadMeetsData(meets);
            
            // Clear manual entry form
            document.getElementById('manualSwimmerName').value = '';
            document.getElementById('manualMeetName').value = '';
            document.getElementById('manualMeetDate').value = '';
            
            // Hide manual entry panel
            document.getElementById('manualEntryPanel').style.display = 'none';
            
            debugLog('Manual data saved successfully', 'success');
        }

        function showTroubleshootingInfo() {
            // Check if troubleshooting info already exists
            if (document.getElementById('troubleshootingInfo')) return;
            
            const troubleshootingDiv = document.createElement('div');
            troubleshootingDiv.id = 'troubleshootingInfo';
            troubleshootingDiv.className = 'troubleshooting-info';
            troubleshootingDiv.innerHTML = `
                <h4>⚠️ SwimCloud Connection Issues</h4>
                <p style="font-size: 0.85rem; color: #92400e; margin-bottom: 0.5rem;">
                    Automatic SwimCloud data fetching may not work due to browser security restrictions. Here are the current limitations:
                </p>
                <ul>
                    <li><strong>CORS Policy:</strong> SwimCloud blocks cross-origin requests from browsers</li>
                    <li><strong>No Public API:</strong> SwimCloud doesn't provide a public API for developers</li>
                    <li><strong>Browser Restrictions:</strong> Modern browsers prevent scraping other websites directly</li>
                </ul>
                <p style="font-size: 0.85rem; color: #92400e; margin-top: 0.5rem;">
                    <strong>Alternatives:</strong> Use manual entry above, or copy-paste meet results for analysis.
                </p>
            `;
            
            const debugPanel = document.getElementById('debugPanel');
            debugPanel.appendChild(troubleshootingDiv);
            
            debugLog('Troubleshooting information displayed', 'info');
        }

        function validateUrl() {
            const url = document.getElementById('swimcloudUrl').value.trim();
            const validation = document.getElementById('urlValidation');
            
            if (!url) {
                validation.innerHTML = '';
                return;
            }
            
            const swimmerIdMatch = url.match(/swimmer\/(\d+)/);
            
            if (url.includes('swimcloud.com') && swimmerIdMatch) {
                validation.innerHTML = `<span style="color: #10b981; font-size: 0.8rem;">✅ Valid SwimCloud URL - Swimmer ID: ${swimmerIdMatch[1]}</span>`;
            } else if (url.includes('swimcloud.com')) {
                validation.innerHTML = `<span style="color: #f59e0b; font-size: 0.8rem;">⚠️ SwimCloud URL but missing swimmer ID</span>`;
            } else {
                validation.innerHTML = `<span style="color: #ef4444; font-size: 0.8rem;">❌ Not a SwimCloud URL</span>`;
            }
        }

        function quickDiagnostic() {
            addConnectionStep('🔧 Running quick diagnostic...', 'info');
            
            // Check current values
            const url = document.getElementById('swimcloudUrl').value.trim();
            const swimmerName = document.getElementById('swimmerName').value;
            const statusElement = document.getElementById('connectionStatus');
            
            addConnectionStep(`URL: ${url || 'Not provided'}`, 'info');
            addConnectionStep(`Swimmer Name: ${swimmerName || 'Not set'}`, 'info');
            addConnectionStep(`Current Status: ${statusElement.querySelector('.status-text').textContent}`, 'info');
            
            // Check browser capabilities
            if (typeof fetch === 'undefined') {
                addConnectionStep('❌ Browser does not support fetch API', 'error');
            } else {
                addConnectionStep('✅ Browser supports fetch API', 'success');
            }
            
            // Check if we're in a secure context
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                addConnectionStep('✅ Secure context (HTTPS or localhost)', 'success');
            } else {
                addConnectionStep('⚠️ Insecure context - may have CORS issues', 'warning');
            }
            
            addConnectionStep('💡 Try the "🧪 Test System" button to verify connectivity', 'info');
        }

        function loadMeetResults() {
            const meetSelect = document.getElementById('meetSelect');
            const meetId = meetSelect.value;
            
            if (!meetId) {
                document.getElementById('meetResults').style.display = 'none';
                document.getElementById('nutritionCorrelation').style.display = 'none';
                return;
            }

            // Handle special debug options
            if (meetId === 'show-all-data') {
                showAllParsedData();
                return;
            }

            debugLog(`Loading results for meet ID: ${meetId}`, 'info');

            // Get the selected meet data
            const selectedOption = meetSelect.querySelector(`option[value="${meetId}"]`);
            let meetData = null;
            
            if (selectedOption && selectedOption.dataset.meetData) {
                try {
                    meetData = JSON.parse(selectedOption.dataset.meetData);
                    debugLog(`Found meet data: ${meetData.name}`, 'info');
                } catch (error) {
                    debugLog(`Error parsing meet data: ${error.message}`, 'error');
                }
            }

            // Try to parse actual results from the meet's HTML if available
            let results = [];
            if (meetData && meetData.html) {
                debugLog('Attempting to parse meet results from HTML...', 'info');
                results = parseSwimCloudMeetResults(meetData.html, meetId);
            }

            // If no results found, use sample data for demonstration
            if (results.length === 0) {
                debugLog('No results parsed from meet HTML, using sample data', 'warn');
                results = [
                    { event: "50 L Back", eventDetails: "200 MR (Leadoff)", time: "37.70", improvement: "-3.4%", place: "3rd", isPB: false },
                    { event: "50 L Back", eventDetails: "Finals", time: "36.98", improvement: "-1.4%", place: "4th", isPB: false },
                    { event: "50 L Back", eventDetails: "Prelims", time: "36.79", improvement: "-0.9%", place: "3rd", isPB: false },
                    { event: "100 L Back", eventDetails: "Finals", time: "1:21.31", improvement: "", place: "4th", isPB: true },
                    { event: "100 L Back", eventDetails: "Prelims", time: "1:23.10", improvement: "", place: "7th", isPB: true },
                    { event: "50 L Breast", eventDetails: "Prelims", time: "45.60", improvement: "-1.3%", place: "13th", isPB: false },
                    { event: "100 L Breast", eventDetails: "Prelims", time: "1:38.44", improvement: "-1.1%", place: "15th", isPB: false },
                    { event: "50 L Fly", eventDetails: "Prelims", time: "36.36", improvement: "-1.7%", place: "14th", isPB: false },
                    { event: "100 L Fly", eventDetails: "Prelims", time: "1:24.04", improvement: "+1.2%", place: "13th", isPB: true },
                    { event: "200 L IM", eventDetails: "Prelims", time: "3:04.74", improvement: "+0.0%", place: "14th", isPB: true }
                ];
            }

            displayMeetResults(results);
            document.getElementById('meetResults').style.display = 'block';
            document.getElementById('nutritionCorrelation').style.display = 'block';
            
            debugLog(`Displayed ${results.length} results`, 'success');
        }

        function showAllParsedData() {
            debugLog('=== SHOWING ALL PARSED DATA ===', 'info');
            
            // Create a modal or overlay to show the data
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
                align-items: center; justify-content: center; padding: 2rem;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 12px; padding: 2rem; 
                max-width: 80%; max-height: 80%; overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            const meetSelect = document.getElementById('meetSelect');
            const allOptions = Array.from(meetSelect.querySelectorAll('option[data-meet-data]'));
            
            let htmlContent = '<h2>🔍 All Parsed SwimCloud Data</h2>';
            
            if (allOptions.length === 0) {
                htmlContent += '<p>No meet data found. The SwimCloud page may not contain the expected meet structure.</p>';
            } else {
                allOptions.forEach((option, index) => {
                    try {
                        const meetData = JSON.parse(option.dataset.meetData);
                        htmlContent += `
                            <div style="border: 1px solid #e5e7eb; margin: 1rem 0; padding: 1rem; border-radius: 8px;">
                                <h3>Meet ${index + 1}: ${meetData.name}</h3>
                                <p><strong>Date:</strong> ${meetData.date}</p>
                                <p><strong>ID:</strong> ${meetData.id}</p>
                                <details>
                                    <summary>Raw HTML (click to expand)</summary>
                                    <pre style="background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.8rem;">
${meetData.html ? meetData.html.substring(0, 500) + '...' : 'No HTML stored'}
                                    </pre>
                                </details>
                            </div>
                        `;
                    } catch (error) {
                        htmlContent += `<p>Error parsing meet ${index + 1}: ${error.message}</p>`;
                    }
                });
            }
            
            htmlContent += '<button onclick="this.closest(\'[style*=\"position: fixed\"]\').remove()" style="background: #2563eb; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer; margin-top: 1rem;">Close</button>';
            
            content.innerHTML = htmlContent;
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            debugLog('Parsed data modal displayed', 'success');
        }

        // Advanced parsing function for SwimCloud meet results
        function parseSwimCloudMeetResults(html, meetId) {
            debugLog(`Parsing meet results for meet ${meetId}`, 'info');
            
            try {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const results = [];
                
                // SwimCloud uses various structures for meet results
                const resultSelectors = [
                    // Table-based results
                    'table.results tbody tr',
                    'table.meet-results tbody tr',
                    '.results-table tbody tr',
                    
                    // Card-based results
                    '.result-card',
                    '.event-result',
                    '.swim-result',
                    
                    // List-based results
                    '.result-item',
                    '.event-item',
                    
                    // Generic selectors
                    '[data-event]',
                    '[data-time]',
                    'tr:has(.time)',
                    'div:has(.time)'
                ];
                
                for (const selector of resultSelectors) {
                    try {
                        const rows = doc.querySelectorAll(selector);
                        debugLog(`Trying selector "${selector}": found ${rows.length} elements`, 'info');
                        
                        if (rows.length > 0) {
                            rows.forEach((row, index) => {
                                try {
                                    // Multiple approaches to extract event data
                                    let eventName = null;
                                    let eventDetails = null;
                                    let time = null;
                                    let place = null;
                                    let improvement = null;
                                    let isPB = false;
                                    
                                    // Event name extraction
                                    const eventSelectors = ['.event', '.event-name', 'td:first-child', '.stroke', '.distance'];
                                    for (const eventSel of eventSelectors) {
                                        const eventEl = row.querySelector(eventSel);
                                        if (eventEl && eventEl.textContent.trim()) {
                                            eventName = eventEl.textContent.trim();
                                            break;
                                        }
                                    }
                                    
                                    // If no specific event selector, look for swim event patterns
                                    if (!eventName) {
                                        const text = row.textContent;
                                        const eventMatch = text.match(/\b(50|100|200|400|500|800|1000|1500|1650)\s*(L|Y|M)?\s*(Free|Freestyle|Back|Backstroke|Breast|Breaststroke|Fly|Butterfly|IM|Individual Medley)/i);
                                        if (eventMatch) {
                                            eventName = eventMatch[0];
                                        }
                                    }
                                    
                                    // Time extraction
                                    const timeSelectors = ['.time', '.result-time', '.swim-time', 'td:nth-child(2)', '.time-cell'];
                                    for (const timeSel of timeSelectors) {
                                        const timeEl = row.querySelector(timeSel);
                                        if (timeEl && timeEl.textContent.trim()) {
                                            time = timeEl.textContent.trim();
                                            break;
                                        }
                                    }
                                    
                                    // If no specific time selector, look for time patterns
                                    if (!time) {
                                        const text = row.textContent;
                                        const timeMatch = text.match(/\b\d{1,2}:\d{2}\.\d{2}\b|\b\d{2}\.\d{2}\b/);
                                        if (timeMatch) {
                                            time = timeMatch[0];
                                        }
                                    }
                                    
                                    // Place extraction
                                    const placeSelectors = ['.place', '.rank', '.position', '.finish', 'td:last-child'];
                                    for (const placeSel of placeSelectors) {
                                        const placeEl = row.querySelector(placeSel);
                                        if (placeEl && placeEl.textContent.trim()) {
                                            const placeText = placeEl.textContent.trim();
                                            if (/^\d+/.test(placeText)) {
                                                place = placeText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    // Improvement extraction
                                    const impSelectors = ['.improvement', '.imp', '.delta', '.change'];
                                    for (const impSel of impSelectors) {
                                        const impEl = row.querySelector(impSel);
                                        if (impEl && impEl.textContent.trim()) {
                                            improvement = impEl.textContent.trim();
                                            break;
                                        }
                                    }
                                    
                                    // Check for Personal Best indicators
                                    const fullText = row.textContent.toLowerCase();
                                    isPB = fullText.includes('pb') || fullText.includes('personal best') || 
                                           fullText.includes('pr') || fullText.includes('personal record') ||
                                           row.querySelector('.pb, .personal-best, .pr');
                                    
                                    // Event details (Finals, Prelims, etc.)
                                    const detailsMatch = row.textContent.match(/(Finals?|Prelims?|Timed Finals?|Heats?)/i);
                                    eventDetails = detailsMatch ? detailsMatch[0] : 'Finals';
                                    
                                    // Only add if we have at least event name and time
                                    if (eventName && time) {
                                        const result = {
                                            event: eventName,
                                            eventDetails: eventDetails,
                                            time: time,
                                            improvement: improvement || '',
                                            place: place || '',
                                            isPB: isPB
                                        };
                                        
                                        results.push(result);
                                        debugLog(`Parsed result: ${eventName} - ${time} (${place})`, 'success');
                                    }
                                    
                                } catch (error) {
                                    debugLog(`Error parsing result row ${index}: ${error.message}`, 'warn');
                                }
                            });
                            
                            // If we found results with this selector, stop trying others
                            if (results.length > 0) {
                                debugLog(`Successfully parsed ${results.length} results with selector: ${selector}`, 'success');
                                break;
                            }
                        }
                        
                    } catch (error) {
                        debugLog(`Selector ${selector} failed: ${error.message}`, 'warn');
                    }
                }
                
                debugLog(`Total results parsed: ${results.length}`, results.length > 0 ? 'success' : 'warn');
                return results;
                
            } catch (error) {
                debugLog(`Meet results parsing error: ${error.message}`, 'error');
                return [];
            }
        }

        function displayMeetResults(results) {
            const tableBody = document.getElementById('resultsTableBody');
            tableBody.innerHTML = '';

            results.forEach(result => {
                const row = document.createElement('div');
                row.className = 'result-row';

                const improvementClass = result.improvement.startsWith('-') ? 'positive' : 
                                       result.improvement.startsWith('+') ? 'negative' : '';

                // Check if mobile view
                const isMobile = window.innerWidth <= 768;

                if (isMobile) {
                    row.innerHTML = `
                        <div class="col-event">
                            <div class="event-name">${result.event}</div>
                            <div class="event-details">${result.eventDetails}</div>
                        </div>
                        <div class="mobile-result-grid">
                            <div class="mobile-result-item">
                                <div class="mobile-result-label">Time</div>
                                <div class="mobile-result-value result-time">
                                    ${result.time}${result.isPB ? ' <span class="pb-badge">PB</span>' : ''}
                                </div>
                            </div>
                            <div class="mobile-result-item">
                                <div class="mobile-result-label">Imp</div>
                                <div class="mobile-result-value improvement ${improvementClass}">
                                    ${result.improvement || '–'}
                                </div>
                            </div>
                            <div class="mobile-result-item">
                                <div class="mobile-result-label">Place</div>
                                <div class="mobile-result-value place">${result.place}</div>
                            </div>
                        </div>
                    `;
                } else {
                    row.innerHTML = `
                        <div class="col-event">
                            <div class="event-name">${result.event}</div>
                            <div class="event-details">${result.eventDetails}</div>
                        </div>
                        <div class="col-time">
                            <span class="result-time">${result.time}</span>
                            ${result.isPB ? '<span class="pb-badge">PB</span>' : ''}
                        </div>
                        <div class="col-improvement">
                            <span class="improvement ${improvementClass}">${result.improvement || '–'}</span>
                        </div>
                        <div class="col-place">
                            <span class="place">${result.place}</span>
                        </div>
                    `;
                }

                tableBody.appendChild(row);
            });
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .radio-options {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .weight-section, .height-section {
                min-width: auto;
            }
            
            .calendar-integration {
                padding: 0.4rem;
            }
            
            .calendar-integration small {
                font-size: 0.75rem;
            }
            
            .phase-buttons {
                flex-direction: column;
            }
            
            .macro-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .legend {
                flex-direction: column;
                gap: 1rem;
            }

            .diet-info {
                padding: 0.75rem;
            }

            .diet-info h4 {
                font-size: 0.9rem;
            }

            .diet-info p {
                font-size: 0.8rem;
            }

            .avoid-food-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .foods-to-avoid {
                padding: 1.5rem;
            }

            .container {
                padding: 1rem;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 0.25rem;
            }
            
            .event {
                font-size: 0.6rem;
            }
            
            .day-number {
                font-size: 0.8rem;
            }

            /* Performance Tracking Mobile Styles */
            .table-header {
                display: none;
            }

            .result-row {
                display: block;
                padding: 1rem;
                border-bottom: 1px solid #e5e7eb;
            }

            .result-row .col-event {
                margin-bottom: 0.5rem;
            }

            .result-row .event-name {
                font-size: 1rem;
                font-weight: 600;
            }

            .result-row .event-details {
                font-size: 0.85rem;
                color: #666;
            }

            .mobile-result-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 1rem;
                margin-top: 0.5rem;
            }

            .mobile-result-item {
                text-align: center;
            }

            .mobile-result-label {
                font-size: 0.75rem;
                color: #666;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .mobile-result-value {
                font-size: 0.9rem;
                font-weight: 600;
                margin-top: 0.25rem;
            }

            .phase-performance-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .radio-options {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .macro-grid {
                grid-template-columns: 1fr;
            }
            
            .macro-percent {
                font-size: 1.5rem;
            }
            
            .personalized-header h4 {
                font-size: 0.9rem;
            }

            .diet-info {
                padding: 0.5rem;
                margin-bottom: 1.5rem;
            }

            .diet-info h4 {
                font-size: 0.85rem;
            }

            .diet-info p {
                font-size: 0.75rem;
            }

            .diet-compatibility small {
                font-size: 0.7rem;
            }

            .avoid-food-grid {
                grid-template-columns: 1fr;
            }

            .foods-to-avoid {
                padding: 1rem;
                margin-top: 2rem;
            }

            .foods-to-avoid h2 {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/pingchuantsai/Image_storing/main/SwimmerNutrition5-Gold.png" alt="Swimfuel">
                Swimfuel Premium
            </div>
            <ul class="nav-links">
                <li><a id="foodRecLink" class="active" onclick="showPage('food-recommendations')">Food Recommendations</a></li>
                <li><a href="#">Nutrition Plans</a></li>
                <li><a id="calendarLink" onclick="showPage('competition-calendar')">Competition Calendar</a></li>
                <li><a id="performanceLink" onclick="showPage('performance-tracking')">Performance Tracking</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Food Recommendations Section -->
        <div id="food-recommendations" class="page-section active">
            <h1>Food Recommendations</h1>
            <p class="subtitle">
                Based on your training schedule and competition timeline, we've curated personalized food recommendations.<br>
                These suggestions will help you optimize performance, energy levels, and recovery at each phase of your preparation.
            </p>

            <div class="swimmer-profile">
                <h3>Swimmer Profile</h3>
                <div class="profile-form">
                    <div class="profile-group">
                        <label>Age Group</label>
                        <select id="ageGroup">
                            <option value="10-under">10 & Under</option>
                            <option value="11-12">AG 11-12</option>
                            <option value="13-14">AG 13-14</option>
                            <option value="15-over">AG 15 & Over</option>
                        </select>
                    </div>
                    
                    <div class="profile-group">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="female">Female</option>
                            <option value="male">Male</option>
                        </select>
                    </div>

                    <div class="profile-group weight-section">
                        <label>Weight</label>
                        <div class="radio-options">
                            <label class="radio-label">
                                <input type="radio" name="weightUnit" value="kg" checked>
                                Kilograms (kg)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="weightUnit" value="lb">
                                Pounds (lb)
                            </label>
                        </div>
                        <input type="number" id="weightInput" placeholder="Enter weight in kg" min="20" max="150" step="0.1">
                    </div>

                    <div class="profile-group height-section">
                        <label>Height</label>
                        <div class="radio-options">
                            <label class="radio-label">
                                <input type="radio" name="heightUnit" value="cm" checked>
                                Centimeters (cm)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="heightUnit" value="ft-in">
                                Feet & Inches
                            </label>
                        </div>
                        <div id="heightInputContainer">
                            <input type="number" id="heightCmInput" placeholder="Enter height in cm" min="90" max="250" step="1">
                            <div id="heightFtInInputs" class="feet-inches-container" style="display: none;">
                                <input type="number" id="heightFtInput" placeholder="Feet" min="3" max="8" step="1">
                                <input type="number" id="heightInInput" placeholder="Inches" min="0" max="11" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="profile-group">
                        <label>BMI (Calculated)</label>
                        <input type="text" id="bmiResult" placeholder="BMI will be calculated automatically" readonly>
                    </div>

                    <div class="profile-group">
                        <label>Competition Date</label>
                        <input type="date" id="competitionDate">
                        <div class="calendar-integration">
                            <small>
                                💡 <a onclick="showPage('competition-calendar')">View Competition Calendar</a> 
                                to find upcoming meets and sync with your training schedule
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="phase-selector">
                <h3>Select Competition Phase</h3>
                <div class="phase-buttons">
                    <button class="phase-btn active" data-phase="training-1">Training Phase 1<br><small>14-8 Days Out</small></button>
                    <button class="phase-btn" data-phase="training-2">Training Phase 2<br><small>7-3 Days Out</small></button>
                    <button class="phase-btn" data-phase="carb-loading">Carb Loading<br><small>2-1 Days Out</small></button>
                    <button class="phase-btn" data-phase="competition">Competition Day<br><small>Race Day</small></button>
                    <button class="phase-btn" data-phase="recovery">Recovery<br><small>1-2 Days Post</small></button>
                </div>
            </div>

            <div class="nutrition-breakdown">
                <div class="personalized-header" id="personalizedHeader" style="display: none;">
                    <h4 id="swimmerInfo">Customized Plan</h4>
                </div>
                <h3>Nutrition Targets for <span id="currentPhaseName">Training Phase 1 (14-8 Days Out)</span></h3>
                <div class="macro-grid">
                    <div class="macro-card carbs">
                        <div class="macro-percent" id="carbsPercent">50%</div>
                        <div class="macro-label">Carbs</div>
                    </div>
                    <div class="macro-card protein">
                        <div class="macro-percent" id="proteinPercent">18%</div>
                        <div class="macro-label">Protein</div>
                    </div>
                    <div class="macro-card veggies">
                        <div class="macro-percent" id="veggiesPercent">17%</div>
                        <div class="macro-label">Veggies</div>
                    </div>
                    <div class="macro-card fruits">
                        <div class="macro-percent" id="fruitsPercent">15%</div>
                        <div class="macro-label">Fruits</div>
                    </div>
                </div>
                <div class="phase-notes" id="phaseNotes">
                    Build glycogen but keep variety in your nutrition approach
                </div>
            </div>

            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Food Category</label>
                        <select id="categoryFilter">
                            <option value="all">All Categories</option>
                            <option value="protein">Protein</option>
                            <option value="carbohydrates">Carbohydrates</option>
                            <option value="vegetables-high-fiber">Vegetables (High Fiber)</option>
                            <option value="vegetables-low-fiber">Vegetables (Low Fiber)</option>
                            <option value="fruits">Fruits</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Diet Preference</label>
                        <select id="dietFilter">
                            <option value="all">All Diets</option>
                            <option value="regular">Regular</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="paleo">Paleo Diet</option>
                            <option value="pescatarian">Pescatarian</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Recommendation</label>
                        <select id="recommendationFilter">
                            <option value="all">All Recommendations</option>
                            <option value="choose">Choose</option>
                            <option value="limit">Limit</option>
                            <option value="avoid">Avoid</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Search Foods</label>
                        <input type="text" id="searchInput" placeholder="Search by food name...">
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color choose"></div>
                    <span>Choose - foods should be eaten often for optimal performance</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color limit"></div>
                    <span>Limit - foods can be eaten occasionally but should be restricted</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color avoid"></div>
                    <span>Avoid - foods should be avoided during this phase</span>
                </div>
            </div>

            <div class="diet-info">
                <h4>Diet Filter Guide:</h4>
                <p><strong>Regular:</strong> All foods included • <strong>Vegetarian:</strong> No meat or fish • <strong>Vegan:</strong> No animal products • <strong>Paleo:</strong> No grains, legumes, or dairy • <strong>Pescatarian:</strong> Vegetarian + fish allowed</p>
            </div>

            <div class="food-grid" id="foodGrid">
                <!-- Food cards will be inserted here -->
            </div>

            <div class="foods-to-avoid" id="foodsToAvoid" style="display: none;">
                <h2>🚫 Foods to Avoid During This Phase</h2>
                <p class="avoid-subtitle">These foods can negatively impact your performance and should be avoided during carb loading and competition phases.</p>
                
                <div class="avoid-food-grid">
                    <!-- Avoid food cards will be inserted here -->
                </div>
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <h3>No foods found</h3>
                <p>Try adjusting your filters to see more recommendations.</p>
            </div>
        </div>

        <!-- Competition Calendar Section -->
        <div id="competition-calendar" class="page-section">
            <button class="back-btn" onclick="showPage('food-recommendations')">
                ← Back to Food Recommendations
            </button>

            <h1>Competition Calendar</h1>
            <p class="subtitle">
                Manage your competition schedule and plan nutrition strategies around upcoming meets.
            </p>

            <div class="calendar-header">
                <div class="calendar-controls">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="previousPeriod()">◀ Previous</button>
                        <button class="nav-btn" onclick="goToToday()">Today</button>
                        <button class="nav-btn" onclick="nextPeriod()">Next ▶</button>
                    </div>
                    
                    <div class="current-period" id="currentPeriod">July 2025</div>
                    
                    <div class="view-controls">
                        <button class="view-btn active" onclick="setView('single')" id="singleViewBtn">Month View</button>
                        <button class="view-btn" onclick="setView('triple')" id="tripleViewBtn">3-Month View</button>
                    </div>
                </div>
            </div>

            <div class="calendar-legends">
                <div class="legend-grid">
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color meet"></div>
                        <span>Regular Meets</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color time-trial"></div>
                        <span>Time Trials</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color championship"></div>
                        <span>Championships</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color special"></div>
                        <span>Special Events</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color practice"></div>
                        <span>Practice Events</span>
                    </div>
                </div>
            </div>

            <div class="calendar-container">
                <div class="calendar-view single" id="calendarView">
                    <!-- Calendar will be generated here -->
                </div>
            </div>

            <div class="event-form">
                <h3>Add New Event</h3>
                <div class="form-group">
                    <label>Event Title</label>
                    <input type="text" id="eventTitle" placeholder="Enter event title">
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="eventDate">
                </div>
                <div class="form-group">
                    <label>Duration (Days)</label>
                    <select id="eventDuration">
                        <option value="1">1 Day</option>
                        <option value="2">2 Days</option>
                        <option value="3">3 Days</option>
                        <option value="4">4 Days</option>
                        <option value="5">5 Days</option>
                        <option value="6">6 Days</option>
                        <option value="7">7 Days</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Event Type</label>
                    <select id="eventType">
                        <option value="meet">Regular Meet</option>
                        <option value="time-trial">Time Trial</option>
                        <option value="championship">Championship</option>
                        <option value="special">Special Event</option>
                        <option value="practice">Practice Event</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addEvent()">Add Event</button>
                    <button class="btn btn-secondary" onclick="clearForm()">Clear</button>
                </div>
            </div>

            <div class="upcoming-events">
                <h3>Upcoming Events</h3>
                <ul class="event-list" id="upcomingEvents">
                    <!-- Upcoming events will be populated here -->
                </ul>
            </div>
        </div>

        <!-- Performance Tracking Section -->
        <div id="performance-tracking" class="page-section">
            <button class="back-btn" onclick="showPage('food-recommendations')">
                ← Back to Food Recommendations
            </button>

            <h1>Performance Tracking</h1>
            <p class="subtitle">
                Connect your SwimCloud profile to track performance and correlate nutrition phases with race results.
            </p>

            <div class="swimmer-profile">
                <h3>SwimCloud Connection</h3>
                <div class="profile-form">
                    <div class="profile-group">
                        <label>SwimCloud Profile URL</label>
                        <input type="url" id="swimcloudUrl" placeholder="https://www.swimcloud.com/swimmer/1234567/" 
                               onchange="loadSwimmerData()" oninput="validateUrl()">
                        <small style="color: #666; margin-top: 0.5rem; display: block;">
                            Enter your SwimCloud profile URL to import meet results
                        </small>
                        <div id="urlValidation" style="margin-top: 0.5rem;"></div>
                    </div>
                    <div class="profile-group">
                        <label>Swimmer Name</label>
                        <input type="text" id="swimmerName" placeholder="Loading..." readonly>
                    </div>
                    <div class="profile-group">
                        <label>Connection Status</label>
                        <div id="connectionStatus" class="status-indicator">
                            <span class="status-text">Not connected</span>
                        </div>
                    </div>
                </div>
                
                <div class="debug-panel" id="debugPanel" style="display: none;">
                    <h4>Debug Information</h4>
                    <div class="debug-content">
                        <div id="debugLog"></div>
                        <button class="btn btn-secondary" onclick="toggleDebugMode()">Toggle Debug</button>
                        <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
                        <button class="btn btn-secondary" onclick="showManualEntry()">Manual Entry</button>
                        <button class="btn btn-primary" onclick="testWithSampleUrl()">🧪 Test System</button>
                        <button class="btn btn-secondary" onclick="quickDiagnostic()">🔧 Quick Check</button>
                    </div>
                </div>

                <div class="connection-status-detail" id="connectionStatusDetail" style="display: none;">
                    <h4>Connection Details</h4>
                    <div id="connectionSteps"></div>
                </div>

                <div class="manual-entry-panel" id="manualEntryPanel" style="display: none;">
                    <h4>Manual Data Entry</h4>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                        If automatic SwimCloud connection fails, you can manually enter meet data:
                    </p>
                    <div class="manual-form">
                        <div class="form-row">
                            <input type="text" id="manualSwimmerName" placeholder="Swimmer Name">
                            <button class="btn btn-primary" onclick="saveManualData()">Save Data</button>
                        </div>
                        <div class="form-row">
                            <input type="text" id="manualMeetName" placeholder="Meet Name">
                            <input type="text" id="manualMeetDate" placeholder="Meet Date">
                        </div>
                        <small style="color: #666;">
                            This will create sample data for testing the nutrition correlation features.
                        </small>
                    </div>
                </div>
            </div>

            <div class="performance-content" id="performanceContent" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Meets</h2>
                    <a href="#" class="see-all-link">See all</a>
                </div>

                <div class="meet-selector">
                    <div class="meet-dropdown">
                        <select id="meetSelect" onchange="loadMeetResults()">
                            <option value="">Select a meet...</option>
                        </select>
                    </div>
                </div>

                <div class="meet-results" id="meetResults" style="display: none;">
                    <div class="results-table">
                        <div class="table-header">
                            <div class="col-event">Event</div>
                            <div class="col-time">Time</div>
                            <div class="col-improvement">Imp</div>
                            <div class="col-place">Place</div>
                        </div>
                        <div class="table-body" id="resultsTableBody">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="nutrition-correlation" id="nutritionCorrelation" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Nutrition Analysis</h3>
                    </div>
                    <div class="correlation-content">
                        <p>Analyze how your nutrition phases correlate with performance improvements.</p>
                        <div class="phase-performance-grid">
                            <div class="phase-card">
                                <h4>Training Phase Performance</h4>
                                <div class="metric">Average improvement: <span class="metric-value">+2.1%</span></div>
                            </div>
                            <div class="phase-card">
                                <h4>Competition Day Performance</h4>
                                <div class="metric">Best times achieved: <span class="metric-value">67%</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Set active nav link
            if (pageId === 'food-recommendations') {
                document.getElementById('foodRecLink').classList.add('active');
            } else if (pageId === 'competition-calendar') {
                document.getElementById('calendarLink').classList.add('active');
                // Initialize calendar when shown
                if (!calendarInitialized) {
                    renderCalendar();
                    calendarInitialized = true;
                }
            } else if (pageId === 'performance-tracking') {
                document.getElementById('performanceLink').classList.add('active');
            }
        }

        // Global variables
        let currentPhase = 'training-1';
        let currentAgeGroup = '10-under';
        let currentCategory = 'all';
        let currentRecommendation = 'all';
        let currentDiet = 'all';
        let searchTerm = '';

        // Calendar variables
        let currentView = 'single';
        let currentDate = new Date();
        const today = new Date();
        let events = [];
        let calendarInitialized = false;

        // Age-specific nutrition data based on competition timeline
        const ageSpecificNutrition = {
            'training-1': {
                name: 'Training Phase 1 (14-8 Days Out)',
                notes: 'Build glycogen but keep variety in your nutrition approach',
                '10-under': { carbs: '50%', protein: '18%', veggies: '17%', fruits: '15%' },
                '11-12': { carbs: '50%', protein: '20%', veggies: '15%', fruits: '15%' },
                '13-14': { carbs: '50%', protein: '22%', veggies: '15%', fruits: '13%' },
                '15-over': { carbs: '50%', protein: '25%', veggies: '15%', fruits: '10%' }
            },
            'training-2': {
                name: 'Training Phase 2 (7-3 Days Out)',
                notes: 'Taper training and begin glycogen loading protocol',
                '10-under': { carbs: '55%', protein: '17%', veggies: '13%', fruits: '15%' },
                '11-12': { carbs: '58%', protein: '18%', veggies: '12%', fruits: '12%' },
                '13-14': { carbs: '60%', protein: '18%', veggies: '12%', fruits: '10%' },
                '15-over': { carbs: '62%', protein: '18%', veggies: '10%', fruits: '10%' }
            },
            'carb-loading': {
                name: 'Carb Loading (2-1 Days Out)',
                notes: 'Begin fiber-reduction and low-residue foods, maintain hydration',
                '10-under': { carbs: '62%', protein: '18%', veggies: '10%', fruits: '10%' },
                '11-12': { carbs: '64%', protein: '17%', veggies: '10%', fruits: '9%' },
                '13-14': { carbs: '65%', protein: '16%', veggies: '9%', fruits: '10%' },
                '15-over': { carbs: '66%', protein: '16%', veggies: '8%', fruits: '10%' }
            },
            'competition': {
                name: 'Competition Day (Race Day)', 
                notes: 'Fast-fuel, easy-digest foods only. Small frequent portions',
                '10-under': { carbs: '67%', protein: '15%', veggies: '8%', fruits: '10%' },
                '11-12': { carbs: '68%', protein: '15%', veggies: '7%', fruits: '10%' },
                '13-14': { carbs: '69%', protein: '15%', veggies: '6%', fruits: '10%' },
                '15-over': { carbs: '70%', protein: '15%', veggies: '5%', fruits: '10%' }
            },
            'recovery': {
                name: 'Recovery (1-2 Days Post)',
                notes: 'Replenish glycogen and support muscle recovery',
                '10-under': { carbs: '50%', protein: '18%', veggies: '17%', fruits: '15%' },
                '11-12': { carbs: '50%', protein: '20%', veggies: '15%', fruits: '15%' },
                '13-14': { carbs: '50%', protein: '22%', veggies: '15%', fruits: '13%' },
                '15-over': { carbs: '50%', protein: '25%', veggies: '15%', fruits: '10%' }
            }
        };

        // Food database with phase-specific recommendations and diet compatibility
        const foodDatabase = {
            protein: [
                { name: "Chicken Breast", emoji: "🐔", benefits: ["Complete protein", "Lean muscle building", "Easy to digest"], diets: ["regular", "paleo"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Turkey Breast", emoji: "🦃", benefits: ["High protein", "Low fat", "B vitamins"], diets: ["regular", "paleo"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Salmon", emoji: "🐟", benefits: ["Omega-3 fatty acids", "Anti-inflammatory", "Complete protein"], diets: ["regular", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Greek Yogurt", emoji: "🥛", benefits: ["Probiotics", "Quick absorption", "Calcium"], diets: ["regular", "vegetarian", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Eggs", emoji: "🥚", benefits: ["Complete amino acids", "Versatile", "Choline"], diets: ["regular", "vegetarian", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Quinoa", emoji: "🌾", benefits: ["Complete protein", "Complex carbs", "Fiber"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Lentils", emoji: "🫘", benefits: ["Plant protein", "Iron", "Folate"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "limit" }},
                { name: "Tuna", emoji: "🐟", benefits: ["Lean protein", "Convenient", "B vitamins"], diets: ["regular", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Almonds", emoji: "🌰", benefits: ["Healthy fats", "Vitamin E", "Magnesium"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Tofu", emoji: "🥡", benefits: ["Plant-based", "Calcium", "Isoflavones"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ],
            carbohydrates: [
                { name: "Brown Rice", emoji: "🍚", benefits: ["Complex carbs", "B vitamins", "Sustained energy"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Sweet Potatoes", emoji: "🍠", benefits: ["Beta carotene", "Complex carbs", "Potassium"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Oats", emoji: "🥣", benefits: ["Beta glucan", "Fiber", "Sustained energy"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Whole Wheat Bread", emoji: "🍞", benefits: ["Fiber", "B vitamins", "Iron"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Pasta", emoji: "🍝", benefits: ["Quick energy", "Carb loading", "Familiar"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Bananas", emoji: "🍌", benefits: ["Quick energy", "Potassium", "Easy to digest"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "White Potatoes", emoji: "🥔", benefits: ["Quick carbs", "Potassium", "Familiar"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Dates", emoji: "🌴", benefits: ["Natural sugars", "Potassium", "Quick energy"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Sourdough Bread", emoji: "🥖", benefits: ["Easy to digest", "Lower glycemic", "Probiotics"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ],
            "vegetables-high-fiber": [
                { name: "Broccoli", emoji: "🥦", benefits: ["Vitamin C", "Fiber", "Antioxidants"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Brussels Sprouts", emoji: "🥬", benefits: ["Vitamin K", "Fiber", "Folate"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Spinach", emoji: "🍃", benefits: ["Iron", "Folate", "Nitrates"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Kale", emoji: "🥬", benefits: ["Vitamin A", "Calcium", "Antioxidants"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Carrots", emoji: "🥕", benefits: ["Beta carotene", "Fiber", "Vitamin A"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Artichokes", emoji: "🌿", benefits: ["High fiber", "Antioxidants", "Prebiotics"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "limit", "carb-loading": "avoid", "competition": "avoid", recovery: "limit" }}
            ],
            "vegetables-low-fiber": [
                { name: "Tomatoes", emoji: "🍅", benefits: ["Lycopene", "Vitamin C", "Hydrating"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Cucumbers", emoji: "🥒", benefits: ["Hydrating", "Low calorie", "Refreshing"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Lettuce", emoji: "🥬", benefits: ["Hydrating", "Low calorie", "Vitamin K"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Bell Peppers", emoji: "🫑", benefits: ["Vitamin C", "Antioxidants", "Low fiber"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Avocados", emoji: "🥑", benefits: ["Healthy fats", "Potassium", "Creamy texture"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Mushrooms", emoji: "🍄", benefits: ["Umami flavor", "B vitamins", "Low calorie"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }}
            ],
            fruits: [
                { name: "Oranges", emoji: "🍊", benefits: ["Vitamin C", "Hydrating", "Natural sugars"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Watermelon", emoji: "🍉", benefits: ["Hydrating", "Quick sugars", "Refreshing"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Grapes", emoji: "🍇", benefits: ["Quick energy", "Antioxidants", "Convenient"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Apples", emoji: "🍎", benefits: ["Fiber", "Vitamin C", "Pectin"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Berries", emoji: "🫐", benefits: ["Antioxidants", "Vitamin C", "Anti-inflammatory"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Melons", emoji: "🍈", benefits: ["Hydrating", "Potassium", "Easy to digest"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Peaches", emoji: "🍑", benefits: ["Vitamin A", "Natural sugars", "Hydrating"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ]
        };

        // Calendar Functions
        function setView(view) {
            currentView = view;
            document.getElementById('singleViewBtn').classList.toggle('active', view === 'single');
            document.getElementById('tripleViewBtn').classList.toggle('active', view === 'triple');
            document.getElementById('calendarView').className = `calendar-view ${view}`;
            renderCalendar();
        }

        function previousPeriod() {
            if (currentView === 'single') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 3);
            }
            renderCalendar();
        }

        function nextPeriod() {
            if (currentView === 'single') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 3);
            }
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }

        function renderCalendar() {
            const calendarView = document.getElementById('calendarView');
            const monthsToShow = currentView === 'single' ? 1 : 3;
            
            // Update period display
            updatePeriodDisplay();
            
            calendarView.innerHTML = '';
            
            for (let i = 0; i < monthsToShow; i++) {
                const monthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + i, 1);
                const monthCalendar = createMonthCalendar(monthDate);
                calendarView.appendChild(monthCalendar);
            }
            
            renderUpcomingEvents();
        }

        function updatePeriodDisplay() {
            const periodElement = document.getElementById('currentPeriod');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            if (currentView === 'single') {
                periodElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            } else {
                const startMonth = monthNames[currentDate.getMonth()];
                const endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 1);
                const endMonth = monthNames[endDate.getMonth()];
                const year = currentDate.getFullYear();
                periodElement.textContent = `${startMonth} - ${endMonth} ${year}`;
            }
        }

        function createMonthCalendar(monthDate) {
            const monthContainer = document.createElement('div');
            monthContainer.className = 'month-calendar';
            
            // Month header
            const monthHeader = document.createElement('div');
            monthHeader.className = 'month-header';
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            monthHeader.textContent = `${monthNames[monthDate.getMonth()]} ${monthDate.getFullYear()}`;
            
            // Weekdays header
            const weekdays = document.createElement('div');
            weekdays.className = 'weekdays';
            const weekdayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdayNames.forEach(day => {
                const weekday = document.createElement('div');
                weekday.className = 'weekday';
                weekday.textContent = day;
                weekdays.appendChild(weekday);
            });
            
            // Calendar grid
            const calendarGrid = document.createElement('div');
            calendarGrid.className = 'calendar-grid';
            
            // Get first day of month and days in month
            const firstDay = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
            const lastDay = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Create calendar days
            for (let i = 0; i < 42; i++) { // 6 weeks * 7 days
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + i);
                
                const dayElement = createDayElement(dayDate, monthDate);
                calendarGrid.appendChild(dayElement);
            }
            
            monthContainer.appendChild(monthHeader);
            monthContainer.appendChild(weekdays);
            monthContainer.appendChild(calendarGrid);
            
            return monthContainer;
        }

        function createDayElement(date, monthDate) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            
            // Check if day is in current month
            if (date.getMonth() !== monthDate.getMonth()) {
                dayElement.classList.add('other-month');
            }
            
            // Check if day is today
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }
            
            // Day number
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = date.getDate();
            dayElement.appendChild(dayNumber);
            
            // Check for events on this day (including multi-day events)
            const dateString = date.toISOString().split('T')[0];
            const dayEvents = getEventsForDate(dateString);
            
            dayEvents.forEach(eventInfo => {
                const eventElement = document.createElement('div');
                eventElement.className = `event ${eventInfo.event.type}`;
                
                // Show different text based on which day of the event it is
                let displayText = eventInfo.event.title;
                if (eventInfo.event.duration > 1) {
                    if (eventInfo.dayNumber === 1) {
                        displayText += ` (Day 1/${eventInfo.event.duration})`;
                    } else if (eventInfo.dayNumber === eventInfo.event.duration) {
                        displayText += ` (Final Day)`;
                    } else {
                        displayText += ` (Day ${eventInfo.dayNumber}/${eventInfo.event.duration})`;
                    }
                }
                
                eventElement.textContent = displayText;
                eventElement.title = `${eventInfo.event.title} - Day ${eventInfo.dayNumber} of ${eventInfo.event.duration}`; // Tooltip
                dayElement.appendChild(eventElement);
            });
            
            // Click handler to populate form
            dayElement.addEventListener('click', () => {
                document.getElementById('eventDate').value = dateString;
            });
            
            return dayElement;
        }

        function getEventsForDate(dateString) {
            const targetDate = new Date(dateString);
            const eventsForDay = [];
            
            events.forEach(event => {
                const startDate = new Date(event.startDate);
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + event.duration - 1);
                
                // Check if target date falls within event duration
                if (targetDate >= startDate && targetDate <= endDate) {
                    const daysDiff = Math.floor((targetDate - startDate) / (1000 * 60 * 60 * 24));
                    eventsForDay.push({
                        event: event,
                        dayNumber: daysDiff + 1
                    });
                }
            });
            
            return eventsForDay;
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const startDate = document.getElementById('eventDate').value;
            const duration = parseInt(document.getElementById('eventDuration').value);
            const type = document.getElementById('eventType').value;
            
            if (!title || !startDate) {
                alert('Please fill in both title and start date');
                return;
            }
            
            // Create event object with duration
            const newEvent = {
                title,
                startDate,
                duration,
                type
            };
            
            events.push(newEvent);
            events.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            clearForm();
            renderCalendar();
        }

        function clearForm() {
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventDuration').value = '1';
            document.getElementById('eventType').value = 'meet';
        }

        function renderUpcomingEvents() {
            const upcomingEvents = document.getElementById('upcomingEvents');
            const todayString = today.toISOString().split('T')[0];
            
            const futureEvents = events
                .filter(event => event.startDate >= todayString)
                .slice(0, 5); // Show next 5 events
            
            upcomingEvents.innerHTML = '';
            
            if (futureEvents.length === 0) {
                upcomingEvents.innerHTML = '<li style="color: #666; font-style: italic;">No upcoming events scheduled. Add events using the form above.</li>';
                return;
            }
            
            futureEvents.forEach(event => {
                const eventItem = document.createElement('li');
                eventItem.className = `event-item ${event.type}`;
                
                const startDate = new Date(event.startDate);
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + event.duration - 1);
                
                let dateString;
                if (event.duration === 1) {
                    dateString = startDate.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                } else {
                    const startStr = startDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    const endStr = endDate.toLocaleDateString('en-US', { 
                        weekday: 'short',
                        year: 'numeric',
                        month: 'short', 
                        day: 'numeric' 
                    });
                    dateString = `${startStr} - ${endStr} (${event.duration} days)`;
                }
                
                eventItem.innerHTML = `
                    <div class="event-date">${dateString}</div>
                    <div class="event-title">${event.title}</div>
                `;
                
                upcomingEvents.appendChild(eventItem);
            });
        }

        // Food Recommendation Functions
        function setupEventListeners() {
            // Profile inputs
            document.getElementById('ageGroup').addEventListener('change', function() {
                currentAgeGroup = this.value;
                updateNutritionBreakdown();
            });

            document.getElementById('gender').addEventListener('change', function() {
                updateNutritionBreakdown();
            });

            // Weight radio buttons
            document.querySelectorAll('input[name="weightUnit"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updateWeightInputLimits();
                    calculateBMI();
                    updateNutritionBreakdown();
                });
            });

            document.getElementById('weightInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            // Height radio buttons
            document.querySelectorAll('input[name="heightUnit"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleHeightInputs();
                    calculateBMI();
                    updateNutritionBreakdown();
                });
            });

            // Height inputs
            document.getElementById('heightCmInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('heightFtInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('heightInInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('competitionDate').addEventListener('change', function() {
                updateNutritionBreakdown();
            });

            // Phase selector buttons
            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPhase = this.dataset.phase;
                    updateNutritionBreakdown();
                    renderFoods();
                });
            });

            // Filter controls
            document.getElementById('categoryFilter').addEventListener('change', function() {
                currentCategory = this.value;
                renderFoods();
            });

            document.getElementById('dietFilter').addEventListener('change', function() {
                currentDiet = this.value;
                renderFoods();
            });

            document.getElementById('recommendationFilter').addEventListener('change', function() {
                currentRecommendation = this.value;
                renderFoods();
            });

            document.getElementById('searchInput').addEventListener('input', function() {
                searchTerm = this.value.toLowerCase();
                renderFoods();
            });
        }

        function updateWeightInputLimits() {
            const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
            const weightInput = document.getElementById('weightInput');
            
            if (weightUnit === 'kg') {
                weightInput.min = 20;
                weightInput.max = 150;
                weightInput.placeholder = 'Enter weight in kg';
            } else {
                weightInput.min = 44;
                weightInput.max = 330;
                weightInput.placeholder = 'Enter weight in lb';
            }
        }

        function toggleHeightInputs() {
            const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
            const cmInput = document.getElementById('heightCmInput');
            const ftInInputs = document.getElementById('heightFtInInputs');

            if (heightUnit === 'cm') {
                cmInput.style.display = 'block';
                ftInInputs.style.display = 'none';
            } else {
                cmInput.style.display = 'none';
                ftInInputs.style.display = 'flex';
            }
        }

        function getHeightInCm() {
            const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
            
            if (heightUnit === 'cm') {
                return parseFloat(document.getElementById('heightCmInput').value) || 0;
            } else {
                const ft = parseFloat(document.getElementById('heightFtInput').value) || 0;
                const inches = parseFloat(document.getElementById('heightInInput').value) || 0;
                const totalInches = (ft * 12) + inches;
                return totalInches * 2.54;
            }
        }

        function getWeightInKg() {
            const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
            const weight = parseFloat(document.getElementById('weightInput').value) || 0;
            
            if (weightUnit === 'kg') {
                return weight;
            } else {
                return weight * 0.453592;
            }
        }

        function calculateBMI() {
            const heightCm = getHeightInCm();
            const weightKg = getWeightInKg();
            
            if (heightCm > 0 && weightKg > 0) {
                const heightM = heightCm / 100;
                const bmi = weightKg / (heightM * heightM);
                
                document.getElementById('bmiResult').value = bmi.toFixed(1);
                return bmi;
            } else {
                document.getElementById('bmiResult').value = '';
                return null;
            }
        }

        function updateNutritionBreakdown() {
            const phaseData = ageSpecificNutrition[currentPhase];
            const ageData = phaseData[currentAgeGroup];
            
            document.getElementById('currentPhaseName').textContent = phaseData.name;
            document.getElementById('carbsPercent').textContent = ageData.carbs;
            document.getElementById('proteinPercent').textContent = ageData.protein;
            document.getElementById('veggiesPercent').textContent = ageData.veggies;
            document.getElementById('fruitsPercent').textContent = ageData.fruits;
            document.getElementById('phaseNotes').textContent = phaseData.notes;

            updatePersonalizedHeader();

            const weightKg = getWeightInKg();
            if (weightKg > 0) {
                updateWeightBasedRecommendations(weightKg, ageData);
            }
        }

        function updatePersonalizedHeader() {
            const ageGroup = document.getElementById('ageGroup').value;
            const gender = document.getElementById('gender').value;
            const weightValue = document.getElementById('weightInput').value;
            const heightCm = getHeightInCm();
            const bmi = calculateBMI();
            
            const ageGroupNames = {
                '10-under': '10 & Under',
                '11-12': 'AG 11-12',
                '13-14': 'AG 13-14', 
                '15-over': 'AG 15 & Over'
            };

            if (weightValue && heightCm > 0) {
                const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
                const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
                
                let heightDisplay = '';
                if (heightUnit === 'ft-in') {
                    const ft = document.getElementById('heightFtInput').value;
                    const inches = document.getElementById('heightInInput').value;
                    heightDisplay = `${ft}'${inches}"`;
                } else {
                    heightDisplay = `${Math.round(heightCm)}cm`;
                }

                const headerText = `${ageGroupNames[ageGroup]} ${gender.charAt(0).toUpperCase() + gender.slice(1)} • ${weightValue}${weightUnit} • ${heightDisplay} • BMI: ${bmi ? bmi.toFixed(1) : '--'}`;
                document.getElementById('swimmerInfo').textContent = headerText;
                document.getElementById('personalizedHeader').style.display = 'block';
            } else if (weightValue) {
                const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
                const headerText = `${ageGroupNames[ageGroup]} ${gender.charAt(0).toUpperCase() + gender.slice(1)} • ${weightValue}${weightUnit}`;
                document.getElementById('swimmerInfo').textContent = headerText;
                document.getElementById('personalizedHeader').style.display = 'block';
            } else {
                document.getElementById('personalizedHeader').style.display = 'none';
            }
        }

        function updateWeightBasedRecommendations(weightKg, ageData) {
            const carbsPercent = parseInt(ageData.carbs);
            
            const minCarbsLoading = Math.round(weightKg * 8);
            const maxCarbsLoading = Math.round(weightKg * 12);
            
            const minCarbsMorning = Math.round(weightKg * 1);
            const maxCarbsMorning = Math.round(weightKg * 4);

            let personalizedNotes = ageSpecificNutrition[currentPhase].notes;
            
            if (currentPhase === 'carb-loading' || currentPhase === 'training-2') {
                personalizedNotes += ` | Target: ${minCarbsLoading}-${maxCarbsLoading}g carbs daily`;
            } else if (currentPhase === 'competition') {
                personalizedNotes += ` | Pre-race meal: ${minCarbsMorning}-${maxCarbsMorning}g carbs`;
            }
            
            document.getElementById('phaseNotes').textContent = personalizedNotes;
        }

        function renderFoods() {
            const foodGrid = document.getElementById('foodGrid');
            const noResults = document.getElementById('noResults');
            const foodsToAvoid = document.getElementById('foodsToAvoid');
            let allFoods = [];

            for (const [category, foods] of Object.entries(foodDatabase)) {
                if (currentCategory === 'all' || currentCategory === category) {
                    foods.forEach(food => {
                        const recommendation = food.phases[currentPhase];
                        
                        // Check diet compatibility
                        const isDietCompatible = currentDiet === 'all' || food.diets.includes(currentDiet);
                        
                        if ((currentRecommendation === 'all' || currentRecommendation === recommendation) &&
                            isDietCompatible &&
                            (!searchTerm || food.name.toLowerCase().includes(searchTerm))) {
                            allFoods.push({
                                ...food,
                                category: category,
                                recommendation: recommendation
                            });
                        }
                    });
                }
            }

            const shouldShowAvoidSection = (currentPhase === 'carb-loading' || currentPhase === 'competition' || currentPhase === 'recovery') && 
                                         (currentRecommendation === 'all' || currentRecommendation === 'avoid');
            
            if (shouldShowAvoidSection) {
                foodsToAvoid.style.display = 'block';
                updateAvoidFoodsForPhase();
            } else {
                foodsToAvoid.style.display = 'none';
            }

            if (allFoods.length === 0 && !shouldShowAvoidSection) {
                foodGrid.style.display = 'none';
                noResults.style.display = 'block';
                
                // Update no results message based on active filters
                const noResultsElement = document.getElementById('noResults');
                let message = 'No foods found';
                let suggestion = 'Try adjusting your filters to see more recommendations.';
                
                if (currentDiet !== 'all') {
                    message = `No ${currentDiet} foods found for this phase`;
                    suggestion = `Try selecting "All Diets" or a different phase to see more ${currentDiet} options.`;
                }
                
                noResultsElement.innerHTML = `
                    <h3>${message}</h3>
                    <p>${suggestion}</p>
                `;
                return;
            }

            foodGrid.style.display = 'grid';
            noResults.style.display = 'none';

            const sortOrder = { choose: 0, limit: 1, avoid: 2 };
            allFoods.sort((a, b) => sortOrder[a.recommendation] - sortOrder[b.recommendation]);

            foodGrid.innerHTML = allFoods.map(food => `
                <div class="food-card">
                    <div class="food-image">
                        ${food.emoji}
                    </div>
                    <div class="food-content">
                        <div class="food-name">${food.name}</div>
                        <div class="food-category">${formatCategory(food.category)}</div>
                        <div class="recommendation-badge ${food.recommendation}">
                            ${formatRecommendation(food.recommendation)}
                        </div>
                        <div class="diet-compatibility">
                            <small>${currentDiet === 'all' 
                                ? `Diet-friendly: ${food.diets.map(diet => diet.charAt(0).toUpperCase() + diet.slice(1)).join(', ')}`
                                : `✓ ${currentDiet.charAt(0).toUpperCase() + currentDiet.slice(1)} approved`
                            }</small>
                        </div>
                        <ul class="food-benefits">
                            ${food.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        function updateAvoidFoodsForPhase() {
            const avoidGrid = document.querySelector('.avoid-food-grid');
            const subtitle = document.querySelector('.avoid-subtitle');
            
            if (currentPhase === 'recovery') {
                subtitle.textContent = 'These foods can hinder recovery and should be avoided after competition to optimize muscle repair and rehydration.';
                
                avoidGrid.innerHTML = `
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍗</div>
                        <div class="food-content">
                            <div class="food-name">Fried Chicken</div>
                            <div class="food-category">Deep-Fried Foods</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>High saturated fats</li>
                                <li>Slows digestion</li>
                                <li>Delays nutrient absorption</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🥓</div>
                        <div class="food-content">
                            <div class="food-name">Bacon Heavy Meals</div>
                            <div class="food-category">Deep-Fried Foods</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>High saturated fat</li>
                                <li>High sodium</li>
                                <li>Inflammatory compounds</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍺</div>
                        <div class="food-content">
                            <div class="food-name">Alcohol</div>
                            <div class="food-category">Alcohol</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Impairs muscle recovery</li>
                                <li>Disrupts sleep quality</li>
                                <li>Affects hydration</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else {
                subtitle.textContent = 'These foods can negatively impact your performance and should be avoided during carb loading and competition phases.';
                
                avoidGrid.innerHTML = `
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍟</div>
                        <div class="food-content">
                            <div class="food-name">French Fries</div>
                            <div class="food-category">High-Fat Fried Foods</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Slows digestion</li>
                                <li>Causes bloating</li>
                                <li>Heavy feeling in water</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍩</div>
                        <div class="food-content">
                            <div class="food-name">Donuts</div>
                            <div class="food-category">Sugary Desserts</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Sugar spike & crash</li>
                                <li>High trans fats</li>
                                <li>Energy instability</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🥤</div>
                        <div class="food-content">
                            <div class="food-name">Soda</div>
                            <div class="food-category">Sugary Drinks</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Empty calories</li>
                                <li>Dehydrating</li>
                                <li>Blood sugar spikes</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        function formatCategory(category) {
            return category.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function formatRecommendation(rec) {
            switch(rec) {
                case 'choose': return 'Recommended';
                case 'limit': return 'Limit';
                case 'avoid': return 'Avoid';
                default: return rec;
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            toggleHeightInputs();
            updateWeightInputLimits();
            updateNutritionBreakdown();
            renderFoods();
            
            // Initialize connection tracking
            addConnectionStep('💡 SwimFuel Premium loaded! Enter a SwimCloud URL to get started', 'info');
            addConnectionStep('💡 Use "🧪 Test System" first to verify your connection works', 'info');
        });

        // Handle window resize for mobile responsive table
        window.addEventListener('resize', function() {
            const meetId = document.getElementById('meetSelect').value;
            if (meetId && document.getElementById('meetResults').style.display !== 'none') {
                // Reload results to apply correct mobile/desktop layout
                loadMeetResults();
            }
        });
    </script>
</body>
</html>

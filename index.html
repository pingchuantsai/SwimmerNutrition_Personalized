<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwimFuel Premium - Swimmer Nutrition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .navbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: bold;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #000000;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #1e3a8a;
            background: #eff6ff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        .back-btn {
            background: #e5e7eb;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            color: #666;
            cursor: pointer;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: #d1d5db;
        }

        h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        .subtitle {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        /* Clean header style matching SwimCloud */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .see-all-link {
            color: #2563eb;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .see-all-link:hover {
            text-decoration: underline;
        }

        .swimmer-profile {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .swimmer-profile h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .profile-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .profile-group {
            display: flex;
            flex-direction: column;
        }

        .profile-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .profile-group select, .profile-group input {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .profile-group select:focus, .profile-group input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .radio-options {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: normal;
            cursor: pointer;
            margin-bottom: 0;
        }

        .radio-label input[type="radio"] {
            margin: 0;
            padding: 0;
            width: auto;
            height: auto;
        }

        .weight-section, .height-section {
            min-width: 300px;
        }

        .feet-inches-container {
            display: flex;
            gap: 1rem;
        }

        .feet-inches-container input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .feet-inches-container input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #bmiResult {
            background-color: #f9fafb;
            color: #374151;
            font-weight: 500;
        }

        .calendar-integration {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f0f9ff;
            border-radius: 4px;
            border-left: 3px solid #0ea5e9;
        }

        .calendar-integration small {
            color: #0c4a6e;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .calendar-integration a {
            color: #0284c7;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .calendar-integration a:hover {
            color: #0369a1;
            text-decoration: underline;
        }

        .phase-selector {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .phase-selector h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .phase-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .phase-btn {
            padding: 1rem 1.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-align: center;
            line-height: 1.3;
            min-width: 140px;
        }

        .phase-btn small {
            font-size: 0.8rem;
            font-weight: 500;
            color: #666;
            display: block;
            margin-top: 0.3rem;
        }

        .phase-btn.active {
            border-color: #2563eb;
            background: #2563eb;
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .phase-btn.active small {
            color: #e0e7ff;
        }

        .phase-btn:hover {
            border-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .nutrition-breakdown {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .nutrition-breakdown h3 {
            margin-bottom: 1.5rem;
            color: #111;
            text-align: center;
        }

        .personalized-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .personalized-header h4 {
            margin: 0;
            font-size: 1.1rem;
        }

        .macro-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .macro-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .macro-card.carbs {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .macro-card.protein {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .macro-card.veggies {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .macro-card.fruits {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .macro-percent {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .macro-label {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .phase-notes {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            color: #666;
            font-style: italic;
            border-left: 4px solid #2563eb;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .filter-group select, .filter-group input {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }

        .legend {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .diet-info {
            background: #eff6ff;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 4px solid #3b82f6;
        }

        .diet-info h4 {
            margin: 0 0 0.5rem 0;
            color: #1e40af;
            font-size: 1rem;
        }

        .diet-info p {
            margin: 0;
            color: #374151;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .choose { background: #10b981; }
        .limit { background: #f59e0b; }
        .avoid { background: #ef4444; }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .food-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .food-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .food-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .food-content {
            padding: 1.5rem;
        }

        .food-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #111;
        }

        .food-category {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .recommendation-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }

        .recommendation-badge.choose {
            background: #10b981;
        }

        .recommendation-badge.limit {
            background: #f59e0b;
        }

        .recommendation-badge.avoid {
            background: #ef4444;
        }

        .diet-compatibility {
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            background: #f3f4f6;
            border-radius: 4px;
            border-left: 3px solid #10b981;
        }

        .diet-compatibility small {
            color: #374151;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .food-benefits {
            list-style: none;
        }

        .food-benefits li {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            padding-left: 1rem;
            position: relative;
        }

        .food-benefits li::before {
            content: "•";
            color: #2563eb;
            position: absolute;
            left: 0;
        }

        .foods-to-avoid {
            margin-top: 3rem;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .foods-to-avoid h2 {
            color: #ef4444;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .avoid-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-style: italic;
        }

        .avoid-food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .avoid-card {
            border: 2px solid #fecaca;
            background: #fef2f2;
        }

        .avoid-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.15);
            border-color: #f87171;
        }

        .avoid-image {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .avoid-effects li {
            color: #dc2626;
        }

        .avoid-effects li::before {
            content: "⚠";
            color: #ef4444;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        /* Calendar Styles */
        .calendar-header {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .current-period {
            font-size: 1.5rem;
            font-weight: bold;
            color: #111;
            min-width: 300px;
            text-align: center;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .view-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .view-btn:hover:not(.active) {
            background: #f3f4f6;
        }

        .calendar-legends {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .legend-grid {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .calendar-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calendar-legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .calendar-legend-color.meet { background: #3b82f6; }
        .calendar-legend-color.time-trial { background: #10b981; }
        .calendar-legend-color.championship { background: #f59e0b; }
        .calendar-legend-color.special { background: #ef4444; }
        .calendar-legend-color.practice { background: #8b5cf6; }

        .calendar-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .calendar-view {
            display: grid;
            gap: 1rem;
            padding: 1.5rem;
        }

        .calendar-view.single {
            grid-template-columns: 1fr;
        }

        .calendar-view.triple {
            grid-template-columns: repeat(3, 1fr);
        }

        .month-calendar {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
        }

        .weekday {
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            color: #666;
            border-right: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .weekday:last-child {
            border-right: none;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            min-height: 80px;
            border-right: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
            padding: 0.5rem;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .calendar-day:hover {
            background-color: #f8f9fa;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background-color: #fafafa;
        }

        .calendar-day.today {
            background-color: #eff6ff;
            border: 2px solid #3b82f6;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event {
            background: #3b82f6;
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-bottom: 0.125rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            position: relative;
        }

        .event.time-trial { background: #10b981; }
        .event.championship { background: #f59e0b; }
        .event.special { background: #ef4444; }
        .event.practice { background: #8b5cf6; }

        .triple .calendar-day {
            min-height: 60px;
            padding: 0.25rem;
        }

        .triple .event {
            font-size: 0.55rem;
            padding: 0.1rem 0.15rem;
            margin-bottom: 0.1rem;
        }

        .triple .day-number {
            font-size: 0.8rem;
        }

        /* Multi-day event indicators */
        .event[title*="Day 1"] {
            border-left: 3px solid rgba(255,255,255,0.8);
        }

        .event[title*="Final Day"] {
            border-right: 3px solid rgba(255,255,255,0.8);
        }

        .event[title*="Day 2"]:not([title*="Day 1"]):not([title*="Final Day"]),
        .event[title*="Day 3"]:not([title*="Final Day"]),
        .event[title*="Day 4"]:not([title*="Final Day"]),
        .event[title*="Day 5"]:not([title*="Final Day"]),
        .event[title*="Day 6"]:not([title*="Final Day"]) {
            border-left: 2px solid rgba(255,255,255,0.6);
            border-right: 2px solid rgba(255,255,255,0.6);
        }

        .event-form {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 2rem;
            border: 1px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .upcoming-events {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .upcoming-events h3 {
            margin-bottom: 1rem;
            color: #111;
        }

        .event-list {
            list-style: none;
        }

        .event-item {
            padding: 0.75rem;
            border-left: 4px solid #3b82f6;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            border-radius: 0 6px 6px 0;
        }

        .event-item.time-trial { border-left-color: #10b981; }
        .event-item.championship { border-left-color: #f59e0b; }
        .event-item.special { border-left-color: #ef4444; }
        .event-item.practice { border-left-color: #8b5cf6; }

        .event-date {
            font-weight: 600;
            color: #374151;
        }

        .event-title {
            font-weight: 500;
            margin-top: 0.25rem;
        }

        /* Enhanced Nutrition Plans Styles */
        .plan-setup {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .plan-setup h3 {
            margin-bottom: 1rem;
            color: #333;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .setup-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .nutrition-plan-view {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .plan-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .plan-header h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .plan-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        /* Enhanced Nutrition Calendar View Styles */
        .nutrition-calendar-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nutrition-calendar-weeks {
            display: flex;
            flex-direction: column;
        }

        .nutrition-week {
            border-bottom: 1px solid #e5e7eb;
        }

        .nutrition-week:last-child {
            border-bottom: none;
        }

        .week-header-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
        }

        .week-day-header {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: #666;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .week-day-header:last-child {
            border-right: none;
        }

        .day-name {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .phase-headers-row {
            position: relative;
            height: 50px;
            background: #f8f9fa;
            border-bottom: 2px solid #e5e7eb;
        }

        .phase-header {
            position: absolute;
            top: 0;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            border-radius: 0;
        }

        .phase-header.training-1 {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .phase-header.training-2 {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .phase-header.carb-loading {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .phase-header.competition {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .phase-header.recovery {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-meals {
            border-right: 1px solid #e5e7eb;
            padding: 1rem;
            min-height: 400px;
        }

        .day-meals:last-child {
            border-right: none;
        }

        .meal-time {
            margin-bottom: 1.5rem;
        }

        .meal-time:last-child {
            margin-bottom: 0;
        }

        .meal-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meal-header.breakfast {
            background: #fef3c7;
            color: #92400e;
        }

        .meal-header.lunch {
            background: #d1fae5;
            color: #065f46;
        }

        .meal-header.dinner {
            background: #fee2e2;
            color: #991b1b;
        }

        .meal-header.snack {
            background: #e0e7ff;
            color: #3730a3;
        }

        .meal-icon {
            font-size: 1rem;
        }

        .meal-items {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .meal-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .meal-item:last-child {
            margin-bottom: 0;
        }

        .meal-bullet {
            color: #666;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }

        .meal-item-text {
            flex: 1;
            color: #555;
        }

        .editable-meal-item {
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            padding: 0.25rem;
            font-size: 0.85rem;
            line-height: 1.4;
            color: #555;
            width: 100%;
            transition: all 0.2s;
        }

        .editable-meal-item:hover {
            background: #f8f9fa;
            border-color: #d1d5db;
        }

        .editable-meal-item:focus {
            outline: none;
            background: white;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .add-meal-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #3b82f6;
            font-size: 0.8rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .add-meal-item:hover {
            background: #eff6ff;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .view-toggle-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .view-toggle-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .view-toggle-btn:hover:not(.active) {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .weeks-container {
            padding: 2rem;
        }

        .week-section {
            margin-bottom: 3rem;
        }

        .week-section:last-child {
            margin-bottom: 1rem;
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .week-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .week-dates {
            color: #666;
            font-weight: 500;
            font-size: 1rem;
        }

        .daily-plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .daily-plan-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .daily-plan-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .daily-card-header {
            padding: 1rem;
            color: white;
            text-align: center;
            font-weight: 600;
        }

        .daily-card-header h4 {
            margin: 0 0 0.25rem 0;
            font-size: 1.1rem;
        }

        .phase-label {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .daily-card-content {
            background: white;
            padding: 1.5rem;
        }

        .meal-section {
            margin-bottom: 1.25rem;
        }

        .meal-section:last-child {
            margin-bottom: 0;
        }

        .meal-title {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meal-content {
            font-size: 0.85rem;
            color: #555;
            line-height: 1.4;
            margin-left: 1.5rem;
        }

        /* Phase-specific colors */
        .phase-training-1 { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .phase-training-2 { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .phase-carb-loading { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .phase-competition { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .phase-recovery { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }

        .plan-actions {
            padding: 1.5rem 2rem;
            background: #f8f9fa;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .plan-actions .btn {
            min-width: 140px;
        }

        /* Performance Tracking Styles */
        .meet-selector {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .meet-dropdown select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        .meet-dropdown select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .meet-results {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .results-table {
            width: 100%;
        }

        .table-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            background: #f8f9fa;
            padding: 1rem;
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-body {
            display: flex;
            flex-direction: column;
        }

        .result-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 1rem;
            border-bottom: 1px solid #f1f3f4;
            align-items: center;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-row:hover {
            background-color: #f8f9fa;
        }

        .event-name {
            font-weight: 500;
            color: #333;
        }

        .event-details {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .result-time {
            font-weight: 600;
            color: #2563eb;
            font-size: 1rem;
        }

        .pb-badge {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .improvement {
            font-weight: 500;
        }

        .improvement.positive {
            color: #10b981;
        }

        .improvement.negative {
            color: #ef4444;
        }

        .place {
            font-weight: 500;
            color: #333;
        }

        .nutrition-correlation {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .phase-performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .phase-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #2563eb;
        }

        .phase-card h4 {
            margin: 0 0 1rem 0;
            color: #333;
            font-size: 1rem;
        }

        .metric {
            color: #666;
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            color: #2563eb;
            font-size: 1.1rem;
        }

        /* Debug Panel Styles */
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .debug-panel h4 {
            margin: 0 0 1rem 0;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .debug-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        #debugLog {
            background: #1f2937;
            color: #10b981;
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            min-height: 120px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            background: #f3f4f6;
        }

        .status-text {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status-indicator.connecting {
            background: #fef3c7;
            color: #92400e;
        }

        .status-indicator.connected {
            background: #d1fae5;
            color: #065f46;
        }

        .status-indicator.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        .status-indicator.connecting .status-dot {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected .status-dot {
            background: #10b981;
        }

        .status-indicator.error .status-dot {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .retry-button {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        .retry-button:hover {
            background: #d97706;
        }

        @media (max-width: 1024px) {
            .calendar-view.triple {
                grid-template-columns: 1fr;
            }
            
            .calendar-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .current-period {
                min-width: auto;
                text-align: left;
                font-size: 1.3rem;
            }
            
            .legend-grid {
                flex-direction: column;
                gap: 1rem;
            }

            /* Enhanced Nutrition Calendar Mobile */
            .nutrition-calendar-weeks {
                overflow-x: auto;
            }

            .week-header-row,
            .meals-grid {
                min-width: 800px;
            }

            .day-meals {
                min-height: 350px;
                padding: 0.75rem;
            }

            .meal-header {
                font-size: 0.8rem;
                padding: 0.4rem;
            }

            .meal-item {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .radio-options {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .weight-section, .height-section {
                min-width: auto;
            }
            
            .calendar-integration {
                padding: 0.4rem;
            }
            
            .calendar-integration small {
                font-size: 0.75rem;
            }
            
            .phase-buttons {
                flex-direction: column;
            }
            
            .macro-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-row {
                grid-template-columns: 1fr;
            }
            
            .legend {
                flex-direction: column;
                gap: 1rem;
            }

            .diet-info {
                padding: 0.75rem;
            }

            .diet-info h4 {
                font-size: 0.9rem;
            }

            .diet-info p {
                font-size: 0.8rem;
            }

            .avoid-food-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .foods-to-avoid {
                padding: 1.5rem;
            }

            .container {
                padding: 1rem;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 0.25rem;
            }
            
            .event {
                font-size: 0.6rem;
            }
            
            .day-number {
                font-size: 0.8rem;
            }

            /* Enhanced Nutrition Mobile */
            .nutrition-calendar-container {
                margin: 0 -1rem;
            }

            .week-header-row,
            .meals-grid {
                min-width: 700px;
            }

            .day-meals {
                min-height: 300px;
                padding: 0.5rem;
            }

            .day-number {
                font-size: 1.2rem;
            }

            .meal-header {
                font-size: 0.75rem;
                padding: 0.3rem;
            }

            .meal-item {
                font-size: 0.75rem;
            }

            .setup-form {
                grid-template-columns: 1fr;
            }

            .daily-plans-grid {
                grid-template-columns: 1fr;
            }

            .plan-header {
                padding: 1.5rem 1rem;
            }

            .plan-header h2 {
                font-size: 1.4rem;
            }

            .weeks-container {
                padding: 1rem;
            }

            .week-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .plan-actions {
                padding: 1rem;
                flex-direction: column;
            }

            .plan-actions .btn {
                min-width: auto;
                width: 100%;
            }

            /* Performance Tracking Mobile Styles */
            .table-header {
                display: none;
            }

            .result-row {
                display: block;
                padding: 1rem;
                border-bottom: 1px solid #e5e7eb;
            }

            .result-row .col-event {
                margin-bottom: 0.5rem;
            }

            .result-row .event-name {
                font-size: 1rem;
                font-weight: 600;
            }

            .result-row .event-details {
                font-size: 0.85rem;
                color: #666;
            }

            .mobile-result-grid {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 1rem;
                margin-top: 0.5rem;
            }

            .mobile-result-item {
                text-align: center;
            }

            .mobile-result-label {
                font-size: 0.75rem;
                color: #666;
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .mobile-result-value {
                font-size: 0.9rem;
                font-weight: 600;
                margin-top: 0.25rem;
            }

            .phase-performance-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
            
            .radio-options {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .macro-grid {
                grid-template-columns: 1fr;
            }
            
            .macro-percent {
                font-size: 1.5rem;
            }
            
            .personalized-header h4 {
                font-size: 0.9rem;
            }

            .diet-info {
                padding: 0.5rem;
                margin-bottom: 1.5rem;
            }

            .diet-info h4 {
                font-size: 0.85rem;
            }

            .diet-info p {
                font-size: 0.75rem;
            }

            .diet-compatibility small {
                font-size: 0.7rem;
            }

            .avoid-food-grid {
                grid-template-columns: 1fr;
            }

            .foods-to-avoid {
                padding: 1rem;
                margin-top: 2rem;
            }

            .foods-to-avoid h2 {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/pingchuantsai/Image_storing/main/SwimmerNutrition5-Gold.png" alt="Swimfuel">
                SwimFuel Premium
            </div>
            <ul class="nav-links">
                <li><a id="foodRecLink" class="active" onclick="showPage('food-recommendations')">Food Recommendations</a></li>
                <li><a id="nutritionPlansLink" onclick="showPage('nutrition-plans')">Nutrition Plans</a></li>
                <li><a id="calendarLink" onclick="showPage('competition-calendar')">Competition Calendar</a></li>
                <li><a id="performanceLink" onclick="showPage('performance-tracking')">Performance Tracking</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Food Recommendations Section -->
        <div id="food-recommendations" class="page-section active">
            <h1>Food Recommendations</h1>
            <p class="subtitle">
                Based on your training schedule and competition timeline, we've curated personalized food recommendations.<br>
                These suggestions will help you optimize performance, energy levels, and recovery at each phase of your preparation.
            </p>

            <div class="swimmer-profile">
                <h3>Swimmer Profile</h3>
                <div class="profile-form">
                    <div class="profile-group">
                        <label>Age Group</label>
                        <select id="ageGroup">
                            <option value="10-under">10 & Under</option>
                            <option value="11-12">AG 11-12</option>
                            <option value="13-14">AG 13-14</option>
                            <option value="15-over">AG 15 & Over</option>
                        </select>
                    </div>
                    
                    <div class="profile-group">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="female">Female</option>
                            <option value="male">Male</option>
                        </select>
                    </div>

                    <div class="profile-group weight-section">
                        <label>Weight</label>
                        <div class="radio-options">
                            <label class="radio-label">
                                <input type="radio" name="weightUnit" value="kg" checked>
                                Kilograms (kg)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="weightUnit" value="lb">
                                Pounds (lb)
                            </label>
                        </div>
                        <input type="number" id="weightInput" placeholder="Enter weight in kg" min="20" max="150" step="0.1">
                    </div>

                    <div class="profile-group height-section">
                        <label>Height</label>
                        <div class="radio-options">
                            <label class="radio-label">
                                <input type="radio" name="heightUnit" value="cm" checked>
                                Centimeters (cm)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="heightUnit" value="ft-in">
                                Feet & Inches
                            </label>
                        </div>
                        <div id="heightInputContainer">
                            <input type="number" id="heightCmInput" placeholder="Enter height in cm" min="90" max="250" step="1">
                            <div id="heightFtInInputs" class="feet-inches-container" style="display: none;">
                                <input type="number" id="heightFtInput" placeholder="Feet" min="3" max="8" step="1">
                                <input type="number" id="heightInInput" placeholder="Inches" min="0" max="11" step="1">
                            </div>
                        </div>
                    </div>

                    <div class="profile-group">
                        <label>BMI (Calculated)</label>
                        <input type="text" id="bmiResult" placeholder="BMI will be calculated automatically" readonly>
                    </div>

                    <div class="profile-group">
                        <label>Competition Date</label>
                        <input type="date" id="competitionDate">
                        <div class="calendar-integration">
                            <small>
                                💡 <a onclick="showPage('competition-calendar')">View Competition Calendar</a> 
                                to find upcoming meets and sync with your training schedule
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="phase-selector">
                <h3>Select Competition Phase</h3>
                <div class="phase-buttons">
                    <button class="phase-btn active" data-phase="training-1">Training Phase 1<br><small>14-8 Days Out</small></button>
                    <button class="phase-btn" data-phase="training-2">Training Phase 2<br><small>7-3 Days Out</small></button>
                    <button class="phase-btn" data-phase="carb-loading">Carb Loading<br><small>2-1 Days Out</small></button>
                    <button class="phase-btn" data-phase="competition">Competition Day<br><small>Race Day</small></button>
                    <button class="phase-btn" data-phase="recovery">Recovery<br><small>1-2 Days Post</small></button>
                </div>
            </div>

            <div class="nutrition-breakdown">
                <div class="personalized-header" id="personalizedHeader" style="display: none;">
                    <h4 id="swimmerInfo">Customized Plan</h4>
                </div>
                <h3>Nutrition Targets for <span id="currentPhaseName">Training Phase 1 (14-8 Days Out)</span></h3>
                <div class="macro-grid">
                    <div class="macro-card carbs">
                        <div class="macro-percent" id="carbsPercent">50%</div>
                        <div class="macro-label">Carbs</div>
                    </div>
                    <div class="macro-card protein">
                        <div class="macro-percent" id="proteinPercent">18%</div>
                        <div class="macro-label">Protein</div>
                    </div>
                    <div class="macro-card veggies">
                        <div class="macro-percent" id="veggiesPercent">17%</div>
                        <div class="macro-label">Veggies</div>
                    </div>
                    <div class="macro-card fruits">
                        <div class="macro-percent" id="fruitsPercent">15%</div>
                        <div class="macro-label">Fruits</div>
                    </div>
                </div>
                <div class="phase-notes" id="phaseNotes">
                    Build glycogen but keep variety in your nutrition approach
                </div>
            </div>

            <div class="filters">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Food Category</label>
                        <select id="categoryFilter">
                            <option value="all">All Categories</option>
                            <option value="protein">Protein</option>
                            <option value="carbohydrates">Carbohydrates</option>
                            <option value="vegetables-high-fiber">Vegetables (High Fiber)</option>
                            <option value="vegetables-low-fiber">Vegetables (Low Fiber)</option>
                            <option value="fruits">Fruits</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Diet Preference</label>
                        <select id="dietFilter">
                            <option value="all">All Diets</option>
                            <option value="regular">Regular</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="paleo">Paleo Diet</option>
                            <option value="pescatarian">Pescatarian</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Recommendation</label>
                        <select id="recommendationFilter">
                            <option value="all">All Recommendations</option>
                            <option value="choose">Choose</option>
                            <option value="limit">Limit</option>
                            <option value="avoid">Avoid</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Search Foods</label>
                        <input type="text" id="searchInput" placeholder="Search by food name...">
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color choose"></div>
                    <span>Choose - foods should be eaten often for optimal performance</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color limit"></div>
                    <span>Limit - foods can be eaten occasionally but should be restricted</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color avoid"></div>
                    <span>Avoid - foods should be avoided during this phase</span>
                </div>
            </div>

            <div class="diet-info">
                <h4>Diet Filter Guide:</h4>
                <p><strong>Regular:</strong> All foods included • <strong>Vegetarian:</strong> No meat or fish • <strong>Vegan:</strong> No animal products • <strong>Paleo:</strong> No grains, legumes, or dairy • <strong>Pescatarian:</strong> Vegetarian + fish allowed</p>
            </div>

            <div class="food-grid" id="foodGrid">
                <!-- Food cards will be inserted here -->
            </div>

            <div class="foods-to-avoid" id="foodsToAvoid" style="display: none;">
                <h2>🚫 Foods to Avoid During This Phase</h2>
                <p class="avoid-subtitle">These foods can negatively impact your performance and should be avoided during carb loading and competition phases.</p>
                
                <div class="avoid-food-grid">
                    <!-- Avoid food cards will be inserted here -->
                </div>
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <h3>No foods found</h3>
                <p>Try adjusting your filters to see more recommendations.</p>
            </div>
        </div>

        <!-- Nutrition Plans Section (Enhanced) -->
        <div id="nutrition-plans" class="page-section">
            <h1>Nutrition Plans</h1>
            <p class="subtitle">
                Personalized 2-week meal plans optimized for your competition schedule and training phases.
            </p>

            <div class="plan-setup">
                <h3>Competition Schedule Setup</h3>
                <div class="setup-form">
                    <div class="form-group">
                        <label>Target Competition Date</label>
                        <input type="date" id="targetMeetDate" onchange="generateNutritionPlan()">
                        <small style="color: #666; display: block; margin-top: 0.5rem;">
                            Select your major meet date to generate a 2-week nutrition plan
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Competition Name (Optional)</label>
                        <input type="text" id="competitionName" placeholder="e.g., Regional Championships">
                    </div>
                </div>
            </div>

            <div class="nutrition-plan-view" id="nutritionPlanView" style="display: none;">
                <div class="plan-header">
                    <h2 id="planTitle">2-Week Nutrition Plan</h2>
                    <p id="planSubtitle">Optimized for your competition schedule</p>
                </div>

                <div class="calendar-view-container">
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" id="calendarViewBtn" onclick="switchNutritionView('calendar')">📅 Calendar View</button>
                        <button class="view-toggle-btn" id="cardViewBtn" onclick="switchNutritionView('cards')">🃏 Card View</button>
                    </div>

                    <!-- Enhanced Calendar View -->
                    <div class="calendar-nutrition-view" id="calendarNutritionView">
                        <div class="nutrition-calendar-container">
                            <div class="nutrition-calendar-weeks" id="nutritionCalendarWeeks">
                                <!-- Enhanced calendar weeks will be generated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Original Card View -->
                    <div class="weeks-container" id="cardView" style="display: none;">
                        <div class="week-section">
                            <div class="week-header">
                                <h3 id="week1Title">Week 1: Training Phase</h3>
                                <span id="week1Dates" class="week-dates">Jul 13-19, 2025</span>
                            </div>
                            <div class="daily-plans-grid" id="week1Grid">
                                <!-- Week 1 daily plans will be generated here -->
                            </div>
                        </div>

                        <div class="week-section">
                            <div class="week-header">
                                <h3 id="week2Title">Week 2: Competition Week</h3>
                                <span id="week2Dates" class="week-dates">Jul 20-26, 2025</span>
                            </div>
                            <div class="daily-plans-grid" id="week2Grid">
                                <!-- Week 2 daily plans will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="plan-actions">
                    <button class="btn btn-primary" onclick="downloadPlan()">📥 Download Plan</button>
                    <button class="btn btn-secondary" onclick="printPlan()">🖨️ Print Plan</button>
                    <button class="btn btn-secondary" onclick="sharePlan()">📤 Share Plan</button>
                </div>
            </div>
        </div>

        <!-- Competition Calendar Section -->
        <div id="competition-calendar" class="page-section">
            <button class="back-btn" onclick="showPage('food-recommendations')">
                ← Back to Food Recommendations
            </button>

            <h1>Competition Calendar</h1>
            <p class="subtitle">
                Manage your competition schedule and plan nutrition strategies around upcoming meets.
            </p>

            <div class="calendar-header">
                <div class="calendar-controls">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="previousPeriod()">◀ Previous</button>
                        <button class="nav-btn" onclick="goToToday()">Today</button>
                        <button class="nav-btn" onclick="nextPeriod()">Next ▶</button>
                    </div>
                    
                    <div class="current-period" id="currentPeriod">July 2025</div>
                    
                    <div class="view-controls">
                        <button class="view-btn active" onclick="setView('single')" id="singleViewBtn">Month View</button>
                        <button class="view-btn" onclick="setView('triple')" id="tripleViewBtn">3-Month View</button>
                    </div>
                </div>
            </div>

            <div class="calendar-legends">
                <div class="legend-grid">
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color meet"></div>
                        <span>Regular Meets</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color time-trial"></div>
                        <span>Time Trials</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color championship"></div>
                        <span>Championships</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color special"></div>
                        <span>Special Events</span>
                    </div>
                    <div class="calendar-legend-item">
                        <div class="calendar-legend-color practice"></div>
                        <span>Practice Events</span>
                    </div>
                </div>
            </div>

            <div class="calendar-container">
                <div class="calendar-view single" id="calendarView">
                    <!-- Calendar will be generated here -->
                </div>
            </div>

            <div class="event-form">
                <h3>Add New Event</h3>
                <div class="form-group">
                    <label>Event Title</label>
                    <input type="text" id="eventTitle" placeholder="Enter event title">
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="eventDate">
                </div>
                <div class="form-group">
                    <label>Duration (Days)</label>
                    <select id="eventDuration">
                        <option value="1">1 Day</option>
                        <option value="2">2 Days</option>
                        <option value="3">3 Days</option>
                        <option value="4">4 Days</option>
                        <option value="5">5 Days</option>
                        <option value="6">6 Days</option>
                        <option value="7">7 Days</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Event Type</label>
                    <select id="eventType">
                        <option value="meet">Regular Meet</option>
                        <option value="time-trial">Time Trial</option>
                        <option value="championship">Championship</option>
                        <option value="special">Special Event</option>
                        <option value="practice">Practice Event</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="addEvent()">Add Event</button>
                    <button class="btn btn-secondary" onclick="clearForm()">Clear</button>
                </div>
            </div>

            <div class="upcoming-events">
                <h3>Upcoming Events</h3>
                <ul class="event-list" id="upcomingEvents">
                    <!-- Upcoming events will be populated here -->
                </ul>
            </div>
        </div>

        <!-- Performance Tracking Section -->
        <div id="performance-tracking" class="page-section">
            <button class="back-btn" onclick="showPage('food-recommendations')">
                ← Back to Food Recommendations
            </button>

            <h1>Performance Tracking</h1>
            <p class="subtitle">
                Connect your SwimCloud profile to track performance and correlate nutrition phases with race results.
            </p>

            <div class="swimmer-profile">
                <h3>SwimCloud Connection</h3>
                <div class="profile-form">
                    <div class="profile-group">
                        <label>SwimCloud Profile URL</label>
                        <input type="url" id="swimcloudUrl" placeholder="https://www.swimcloud.com/swimmer/1234567/" 
                               onchange="loadSwimmerData()" oninput="validateUrl()">
                        <small style="color: #666; margin-top: 0.5rem; display: block;">
                            Enter your SwimCloud profile URL to import meet results
                        </small>
                        <div id="urlValidation" style="margin-top: 0.5rem;"></div>
                    </div>
                    <div class="profile-group">
                        <label>Swimmer Name</label>
                        <input type="text" id="swimmerName" placeholder="Loading..." readonly>
                    </div>
                    <div class="profile-group">
                        <label>Connection Status</label>
                        <div id="connectionStatus" class="status-indicator">
                            <span class="status-text">Not connected</span>
                        </div>
                    </div>
                </div>
                
                <div class="debug-panel" id="debugPanel" style="display: none;">
                    <h4>Debug Information</h4>
                    <div class="debug-content">
                        <div id="debugLog"></div>
                        <button class="btn btn-secondary" onclick="toggleDebugMode()">Toggle Debug</button>
                        <button class="btn btn-secondary" onclick="testConnection()">Test Connection</button>
                        <button class="btn btn-secondary" onclick="showManualEntry()">Manual Entry</button>
                        <button class="btn btn-primary" onclick="testWithSampleUrl()">🧪 Test System</button>
                        <button class="btn btn-secondary" onclick="quickDiagnostic()">🔧 Quick Check</button>
                        <button class="btn btn-primary" onclick="showMeetScraper()">📊 Meet Scraper</button>
                    </div>
                </div>
            </div>

            <div class="performance-content" id="performanceContent" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">Meets</h2>
                    <a href="#" class="see-all-link">See all</a>
                </div>

                <div class="meet-selector">
                    <div class="meet-dropdown">
                        <select id="meetSelect" onchange="loadMeetResults()">
                            <option value="">Select a meet...</option>
                        </select>
                    </div>
                </div>

                <div class="meet-results" id="meetResults" style="display: none;">
                    <div class="results-table">
                        <div class="table-header">
                            <div class="col-event">Event</div>
                            <div class="col-time">Time</div>
                            <div class="col-improvement">Imp</div>
                            <div class="col-place">Place</div>
                        </div>
                        <div class="table-body" id="resultsTableBody">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="nutrition-correlation" id="nutritionCorrelation" style="display: none;">
                    <div class="section-header">
                        <h3 class="section-title">Nutrition Analysis</h3>
                    </div>
                    <div class="correlation-content">
                        <p>Analyze how your nutrition phases correlate with performance improvements.</p>
                        <div class="phase-performance-grid">
                            <div class="phase-card">
                                <h4>Training Phase Performance</h4>
                                <div class="metric">Average improvement: <span class="metric-value">+2.1%</span></div>
                            </div>
                            <div class="phase-card">
                                <h4>Competition Day Performance</h4>
                                <div class="metric">Best times achieved: <span class="metric-value">67%</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPhase = 'training-1';
        let currentAgeGroup = '10-under';
        let currentCategory = 'all';
        let currentRecommendation = 'all';
        let currentDiet = 'all';
        let searchTerm = '';

        // Calendar variables
        let currentView = 'single';
        let currentDate = new Date();
        const today = new Date();
        let events = [];
        let calendarInitialized = false;

        // Enhanced Nutrition Calendar variables
        let nutritionCalendarData = {};
        let currentNutritionView = 'calendar';

        // Performance tracking variables
        let debugMode = false;
        let currentSwimmerId = null;
        let connectionSteps = [];

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Set active nav link
            if (pageId === 'food-recommendations') {
                document.getElementById('foodRecLink').classList.add('active');
            } else if (pageId === 'competition-calendar') {
                document.getElementById('calendarLink').classList.add('active');
                // Initialize calendar when shown
                if (!calendarInitialized) {
                    renderCalendar();
                    calendarInitialized = true;
                }
            } else if (pageId === 'performance-tracking') {
                document.getElementById('performanceLink').classList.add('active');
            } else if (pageId === 'nutrition-plans') {
                document.getElementById('nutritionPlansLink').classList.add('active');
            }
        }

        // Enhanced Nutrition Plans Functions
        function switchNutritionView(view) {
            currentNutritionView = view;
            document.getElementById('calendarViewBtn').classList.toggle('active', view === 'calendar');
            document.getElementById('cardViewBtn').classList.toggle('active', view === 'cards');
            
            if (view === 'calendar') {
                document.getElementById('calendarNutritionView').style.display = 'block';
                document.getElementById('cardView').style.display = 'none';
                generateNutritionCalendar();
            } else {
                document.getElementById('calendarNutritionView').style.display = 'none';
                document.getElementById('cardView').style.display = 'block';
                // Generate card view plans
                const meetDate = document.getElementById('targetMeetDate').value;
                if (meetDate) {
                    const meetDateTime = new Date(meetDate);
                    const startDate = new Date(meetDateTime);
                    startDate.setDate(startDate.getDate() - 13);
                    
                    const week1Start = new Date(startDate);
                    const week1End = new Date(startDate);
                    week1End.setDate(week1End.getDate() + 6);
                    
                    const week2Start = new Date(week1End);
                    week2Start.setDate(week2Start.getDate() + 1);
                    const week2End = new Date(meetDateTime);

                    generateWeekPlans('week1Grid', week1Start, week1End, meetDateTime);
                    generateWeekPlans('week2Grid', week2Start, week2End, meetDateTime);
                }
            }
        }

        function generateNutritionCalendar() {
            const meetDate = document.getElementById('targetMeetDate').value;
            if (!meetDate) return;

            const meetDateTime = new Date(meetDate);
            const startDate = new Date(meetDateTime);
            startDate.setDate(startDate.getDate() - 13); // Start 14 days before (including meet day)

            // Generate 2 weeks of calendar
            const weeksContainer = document.getElementById('nutritionCalendarWeeks');
            weeksContainer.innerHTML = '';

            // Generate week 1 (days -13 to -7)
            const week1Start = new Date(startDate);
            const week1End = new Date(startDate);
            week1End.setDate(week1End.getDate() + 6);
            
            const week1 = generateNutritionWeek(week1Start, week1End, meetDateTime, 'Week 1');
            weeksContainer.appendChild(week1);

            // Generate week 2 (days -6 to meet day)
            const week2Start = new Date(week1End);
            week2Start.setDate(week2Start.getDate() + 1);
            const week2End = new Date(meetDateTime);

            const week2 = generateNutritionWeek(week2Start, week2End, meetDateTime, 'Week 2');
            weeksContainer.appendChild(week2);
        }

        function generateNutritionWeek(startDate, endDate, meetDate, weekLabel) {
            const weekContainer = document.createElement('div');
            weekContainer.className = 'nutrition-week';

            // Generate days array for this week
            const days = [];
            const currentDate = new Date(startDate);
            
            // Fill in days from start to end, padding to 7 days
            while (days.length < 7) {
                if (currentDate <= endDate) {
                    days.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                } else {
                    days.push(null); // Empty day
                }
            }

            // Create week header with day names and numbers
            const weekHeader = document.createElement('div');
            weekHeader.className = 'week-header-row';

            const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            days.forEach((day, index) => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'week-day-header';
                
                if (day) {
                    dayHeader.innerHTML = `
                        <div class="day-name">${dayNames[index]}</div>
                        <div class="day-number">${day.getDate()}</div>
                    `;
                } else {
                    dayHeader.innerHTML = `
                        <div class="day-name">${dayNames[index]}</div>
                        <div class="day-number"></div>
                    `;
                }
                weekHeader.appendChild(dayHeader);
            });

            // Create phase headers row
            const phaseHeadersRow = document.createElement('div');
            phaseHeadersRow.className = 'phase-headers-row';

            const phaseHeaders = calculatePhaseHeaders(days, meetDate);
            phaseHeaders.forEach(header => {
                const phaseElement = document.createElement('div');
                phaseElement.className = `phase-header ${header.phase}`;
                phaseElement.style.left = `${header.left}%`;
                phaseElement.style.width = `${header.width}%`;
                phaseElement.textContent = header.label;
                phaseHeadersRow.appendChild(phaseElement);
            });

            // Create meals grid
            const mealsGrid = document.createElement('div');
            mealsGrid.className = 'meals-grid';

            days.forEach((day, dayIndex) => {
                const dayMeals = document.createElement('div');
                dayMeals.className = 'day-meals';

                if (day) {
                    const phase = determinePhase(day, meetDate);
                    const dateKey = day.toISOString().split('T')[0];
                    
                    // Initialize data if not exists
                    if (!nutritionCalendarData[dateKey]) {
                        nutritionCalendarData[dateKey] = initializeDayMeals(phase);
                    }

                    const meals = ['breakfast', 'lunch', 'dinner', 'snack'];
                    const mealIcons = {
                        breakfast: '🍳',
                        lunch: '🍽️',
                        dinner: '🍽️',
                        snack: '🥜'
                    };

                    meals.forEach(mealType => {
                        const mealSection = document.createElement('div');
                        mealSection.className = 'meal-time';

                        const mealHeader = document.createElement('div');
                        mealHeader.className = `meal-header ${mealType}`;
                        mealHeader.innerHTML = `
                            <span class="meal-icon">${mealIcons[mealType]}</span>
                            <span>${mealType.toUpperCase()}</span>
                        `;

                        const mealItems = document.createElement('div');
                        mealItems.className = 'meal-items';

                        // Render existing meal items
                        nutritionCalendarData[dateKey][mealType].forEach((item, itemIndex) => {
                            const mealItem = createEditableMealItem(item, dateKey, mealType, itemIndex);
                            mealItems.appendChild(mealItem);
                        });

                        // Add "Add new item" button
                        const addButton = document.createElement('div');
                        addButton.className = 'add-meal-item';
                        addButton.innerHTML = '<span>+</span> <span>Add item</span>';
                        addButton.onclick = () => addNewMealItem(dateKey, mealType, mealItems);

                        mealSection.appendChild(mealHeader);
                        mealSection.appendChild(mealItems);
                        mealSection.appendChild(addButton);
                        dayMeals.appendChild(mealSection);
                    });
                }

                mealsGrid.appendChild(dayMeals);
            });

            weekContainer.appendChild(weekHeader);
            weekContainer.appendChild(phaseHeadersRow);
            weekContainer.appendChild(mealsGrid);

            return weekContainer;
        }

        function calculatePhaseHeaders(days, meetDate) {
            const headers = [];
            let currentPhase = null;
            let phaseStart = 0;

            days.forEach((day, index) => {
                if (!day) return;

                const phase = determinePhase(day, meetDate);
                
                if (phase !== currentPhase) {
                    // End previous phase
                    if (currentPhase !== null) {
                        headers.push({
                            phase: currentPhase,
                            label: getPhaseLabel(currentPhase),
                            left: (phaseStart / 7) * 100,
                            width: ((index - phaseStart) / 7) * 100
                        });
                    }
                    
                    // Start new phase
                    currentPhase = phase;
                    phaseStart = index;
                }
            });

            // End final phase
            if (currentPhase !== null) {
                const validDays = days.filter(d => d !== null).length;
                headers.push({
                    phase: currentPhase,
                    label: getPhaseLabel(currentPhase),
                    left: (phaseStart / 7) * 100,
                    width: ((validDays - phaseStart) / 7) * 100
                });
            }

            return headers;
        }

        function getPhaseLabel(phase) {
            const labels = {
                'training-1': 'Training Phase 1',
                'training-2': 'Training Phase 2',
                'carb-loading': 'Carb loading',
                'competition': 'Competition Day',
                'recovery': 'Recovery'
            };
            return labels[phase] || phase;
        }

        function determinePhase(date, meetDate) {
            const daysToMeet = Math.ceil((meetDate - date) / (1000 * 60 * 60 * 24));
            
            if (daysToMeet === 0) return 'competition';
            if (daysToMeet < 0) {
                // Post competition - recovery for 1-2 days
                const daysPost = Math.abs(daysToMeet);
                if (daysPost <= 2) return 'recovery';
                return 'recovery';
            }
            if (daysToMeet >= 1 && daysToMeet <= 2) return 'carb-loading';
            if (daysToMeet >= 3 && daysToMeet <= 7) return 'training-2';
            if (daysToMeet >= 8 && daysToMeet <= 14) return 'training-1';
            
            return 'training-1';
        }

        function initializeDayMeals(phase) {
            const defaultMeals = {
                'training-1': {
                    breakfast: [
                        'Whole wheat toast with olive oil',
                        'A glass of 2% milk',
                        'A bowl of fruit'
                    ],
                    lunch: [
                        'Mixed sautéed vegetables',
                        'A fried egg',
                        'Whole wheat bread'
                    ],
                    dinner: [
                        'Oven baked zucchini boats filled with tuna, tomato, and gouda cheese',
                        'Fruit and a glass of milk'
                    ],
                    snack: [
                        'Mixed nuts: cashews, hazelnuts, raisins, pistachios',
                        'Natural yogurt mixed with fruits'
                    ]
                },
                'training-2': {
                    breakfast: [
                        'Whole wheat toast with nut butter',
                        'Natural juice'
                    ],
                    lunch: [
                        'Rice with beef and vegetable stew',
                        'Seasonal fruit'
                    ],
                    dinner: [
                        'Baked eggplant or zucchini boats filled with mozzarella cheese',
                        'Seasonal fruit'
                    ],
                    snack: [
                        'Seasonal fruit smoothie made with whole milk'
                    ]
                },
                'carb-loading': {
                    breakfast: [
                        'Natural orange juice',
                        'Oatmeal',
                        'Dried apricot'
                    ],
                    lunch: [
                        'Cheese stuffed tomatoes',
                        'Chickpeas',
                        'Whole wheat toast',
                        'Yogurt'
                    ],
                    dinner: [
                        'Salad topped with avocado, mushrooms, and ginger',
                        'Beef tenderloin',
                        'Whole wheat toast'
                    ],
                    snack: [
                        'Pear with nuts',
                        'Carrots with Burgos cheese',
                        'Toast, yogurt, and kiwi'
                    ]
                },
                'competition': {
                    breakfast: [
                        'Oatmeal made with milk',
                        'Cacao 70% or drinkable yogurt without added sugars',
                        'Toast with olive oil'
                    ],
                    lunch: [
                        'Couscous with zucchini and onion',
                        '2 tomatoes',
                        'Yogurt'
                    ],
                    dinner: [
                        'Potato purée',
                        'Sautéed peas',
                        'Roasted chicken with lettuce',
                        'Fruit'
                    ],
                    snack: [
                        'Semicurated cheese sandwich',
                        'Apple',
                        'Oatmeal cookies and a banana'
                    ]
                },
                'recovery': {
                    breakfast: [
                        'Protein smoothie with fruit',
                        'Whole grain toast'
                    ],
                    lunch: [
                        'Quinoa bowl with vegetables',
                        'Lean protein'
                    ],
                    dinner: [
                        'Grilled fish with sweet potato',
                        'Steamed vegetables'
                    ],
                    snack: [
                        'Greek yogurt with berries',
                        'Mixed nuts'
                    ]
                }
            };

            return defaultMeals[phase] || defaultMeals['training-1'];
        }

        function createEditableMealItem(text, dateKey, mealType, itemIndex) {
            const mealItem = document.createElement('div');
            mealItem.className = 'meal-item';

            const bullet = document.createElement('span');
            bullet.className = 'meal-bullet';
            bullet.textContent = '•';

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'editable-meal-item';
            input.value = text;
            input.onblur = () => updateMealItem(dateKey, mealType, itemIndex, input.value);
            input.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    input.blur();
                }
            };

            mealItem.appendChild(bullet);
            mealItem.appendChild(input);

            return mealItem;
        }

        function updateMealItem(dateKey, mealType, itemIndex, newValue) {
            if (!nutritionCalendarData[dateKey]) return;
            
            if (newValue.trim() === '') {
                nutritionCalendarData[dateKey][mealType].splice(itemIndex, 1);
                generateNutritionCalendar();
            } else {
                nutritionCalendarData[dateKey][mealType][itemIndex] = newValue.trim();
            }
        }

        function addNewMealItem(dateKey, mealType, mealItemsContainer) {
            if (!nutritionCalendarData[dateKey]) {
                const phase = determinePhase(new Date(dateKey), new Date(document.getElementById('targetMeetDate').value));
                nutritionCalendarData[dateKey] = initializeDayMeals(phase);
            }

            nutritionCalendarData[dateKey][mealType].push('New meal item');
            generateNutritionCalendar();
        }

        function generateWeekPlans(containerId, startDate, endDate, meetDate) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                const dayCard = createDayPlan(currentDate, meetDate);
                container.appendChild(dayCard);
                currentDate.setDate(currentDate.getDate() + 1);
            }
        }

        function createDayPlan(date, meetDate) {
            const phase = determinePhase(date, meetDate);
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
            const dayDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            
            const card = document.createElement('div');
            card.className = 'daily-plan-card';
            
            const phaseNames = {
                'training-1': 'Training Phase 1',
                'training-2': 'Training Phase 2', 
                'carb-loading': 'Carb Loading',
                'competition': 'Competition Day',
                'recovery': 'Recovery Day'
            };

            card.innerHTML = `
                <div class="daily-card-header phase-${phase}">
                    <h4>${dayName}</h4>
                    <div class="phase-label">${dayDate} • ${phaseNames[phase]}</div>
                </div>
                <div class="daily-card-content">
                    ${generateMealSections(phase)}
                </div>
            `;

            return card;
        }

        function generateMealSections(phase) {
            const meals = ['breakfast', 'lunch', 'dinner', 'snack'];
            const mealIcons = {
                breakfast: '🍳',
                lunch: '🥗', 
                dinner: '🍽️',
                snack: '🍎'
            };

            const mealPlans = {
                'training-1': {
                    breakfast: ["Oatmeal with berries and nuts", "Whole grain toast with nut butter"],
                    lunch: ["Grilled chicken with quinoa and vegetables", "Turkey sandwich on whole grain bread"],
                    dinner: ["Baked fish with sweet potato and broccoli", "Lean beef stir-fry with brown rice"],
                    snack: ["Apple with almond butter", "Greek yogurt with berries"]
                },
                'training-2': {
                    breakfast: ["Pancakes with fruit and syrup", "Bagel with honey and banana"],
                    lunch: ["Pasta with marinara and grilled chicken", "Rice bowl with teriyaki chicken"],
                    dinner: ["Spaghetti with meat sauce", "Chicken and rice casserole"],
                    snack: ["Banana with peanut butter", "Energy balls with dates"]
                },
                'carb-loading': {
                    breakfast: ["Large bowl of oatmeal with banana", "Stack of pancakes with syrup"],
                    lunch: ["Large pasta portion with simple sauce", "Rice and chicken bowl"],
                    dinner: ["Huge pasta serving with marinara", "Rice pilaf with lean protein"],
                    snack: ["Sports drink with pretzels", "White bread with honey"]
                },
                'competition': {
                    breakfast: ["Toast with honey and banana", "Oatmeal with easy-digest toppings"],
                    lunch: ["Light pasta with simple sauce", "White rice with grilled chicken"],
                    dinner: ["Simple pasta with olive oil", "White rice with lean fish"],
                    snack: ["Sports drink and crackers", "Banana with sports drink"]
                },
                'recovery': {
                    breakfast: ["Protein smoothie with fruit", "Eggs with whole grain toast"],
                    lunch: ["Chicken and vegetable soup", "Quinoa bowl with protein"],
                    dinner: ["Grilled fish with vegetables", "Lean beef with quinoa"],
                    snack: ["Chocolate milk", "Protein bar"]
                }
            };

            return meals.map(meal => {
                const mealOptions = mealPlans[phase][meal];
                const selectedMeal = mealOptions[Math.floor(Math.random() * mealOptions.length)];
                
                return `
                    <div class="meal-section">
                        <div class="meal-header">
                            <span class="meal-icon">${mealIcons[meal]}</span>
                            <span class="meal-title">${meal}</span>
                        </div>
                        <div class="meal-content">
                            ${selectedMeal}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatDateRange(startDate, endDate) {
            const options = { month: 'short', day: 'numeric' };
            const start = startDate.toLocaleDateString('en-US', options);
            const end = endDate.toLocaleDateString('en-US', { ...options, year: 'numeric' });
            return `${start} - ${end}`;
        }

        function generateNutritionPlan() {
            const meetDate = document.getElementById('targetMeetDate').value;
            const competitionName = document.getElementById('competitionName').value;
            
            if (!meetDate) {
                alert('Please select a competition date');
                return;
            }

            const meetDateTime = new Date(meetDate);
            
            // Calculate 2 weeks before meet date
            const startDate = new Date(meetDateTime);
            startDate.setDate(startDate.getDate() - 13); // 14 days total (including meet day)
            
            // Generate plan title
            const planTitle = competitionName 
                ? `2-Week Nutrition Plan for ${competitionName}`
                : '2-Week Nutrition Plan';
            
            document.getElementById('planTitle').textContent = planTitle;
            document.getElementById('planSubtitle').textContent = 
                `Competition Date: ${meetDateTime.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}`;

            // Generate week date ranges
            const week1Start = new Date(startDate);
            const week1End = new Date(startDate);
            week1End.setDate(week1End.getDate() + 6);
            
            const week2Start = new Date(week1End);
            week2Start.setDate(week2Start.getDate() + 1);
            const week2End = new Date(meetDateTime);

            document.getElementById('week1Dates').textContent = 
                `${formatDateRange(week1Start, week1End)}`;
            document.getElementById('week2Dates').textContent = 
                `${formatDateRange(week2Start, week2End)}`;

            // Clear existing nutrition calendar data
            nutritionCalendarData = {};

            // Generate both views based on current selection
            if (currentNutritionView === 'calendar') {
                generateNutritionCalendar();
            } else {
                generateWeekPlans('week1Grid', week1Start, week1End, meetDateTime);
                generateWeekPlans('week2Grid', week2Start, week2End, meetDateTime);
            }

            // Show the plan
            document.getElementById('nutritionPlanView').style.display = 'block';
        }

        function downloadPlan() {
            const planTitle = document.getElementById('planTitle').textContent;
            const planSubtitle = document.getElementById('planSubtitle').textContent;
            
            let planText = `${planTitle}\n${planSubtitle}\n\n`;
            planText += "Generated by SwimFuel Premium\n";

            const blob = new Blob([planText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'nutrition-plan.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function printPlan() {
            window.print();
        }

        function sharePlan() {
            const planTitle = document.getElementById('planTitle').textContent;
            const planSubtitle = document.getElementById('planSubtitle').textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: planTitle,
                    text: `Check out my ${planTitle} - ${planSubtitle}`,
                    url: window.location.href
                });
            } else {
                const shareText = `${planTitle}\n${planSubtitle}\n\nGenerated by SwimFuel Premium`;
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Plan details copied to clipboard!');
                });
            }
        }

        // Calendar Functions
        function setView(view) {
            currentView = view;
            document.getElementById('singleViewBtn').classList.toggle('active', view === 'single');
            document.getElementById('tripleViewBtn').classList.toggle('active', view === 'triple');
            document.getElementById('calendarView').className = `calendar-view ${view}`;
            renderCalendar();
        }

        function previousPeriod() {
            if (currentView === 'single') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 3);
            }
            renderCalendar();
        }

        function nextPeriod() {
            if (currentView === 'single') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 3);
            }
            renderCalendar();
        }

        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }

        function renderCalendar() {
            const calendarView = document.getElementById('calendarView');
            const monthsToShow = currentView === 'single' ? 1 : 3;
            
            updatePeriodDisplay();
            
            calendarView.innerHTML = '';
            
            for (let i = 0; i < monthsToShow; i++) {
                const monthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + i, 1);
                const monthCalendar = createMonthCalendar(monthDate);
                calendarView.appendChild(monthCalendar);
            }
            
            renderUpcomingEvents();
        }

        function updatePeriodDisplay() {
            const periodElement = document.getElementById('currentPeriod');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            if (currentView === 'single') {
                periodElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            } else {
                const startMonth = monthNames[currentDate.getMonth()];
                const endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 1);
                const endMonth = monthNames[endDate.getMonth()];
                const year = currentDate.getFullYear();
                periodElement.textContent = `${startMonth} - ${endMonth} ${year}`;
            }
        }

        function createMonthCalendar(monthDate) {
            const monthContainer = document.createElement('div');
            monthContainer.className = 'month-calendar';
            
            const monthHeader = document.createElement('div');
            monthHeader.className = 'month-header';
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            monthHeader.textContent = `${monthNames[monthDate.getMonth()]} ${monthDate.getFullYear()}`;
            
            const weekdays = document.createElement('div');
            weekdays.className = 'weekdays';
            const weekdayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdayNames.forEach(day => {
                const weekday = document.createElement('div');
                weekday.className = 'weekday';
                weekday.textContent = day;
                weekdays.appendChild(weekday);
            });
            
            const calendarGrid = document.createElement('div');
            calendarGrid.className = 'calendar-grid';
            
            const firstDay = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
            const lastDay = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const dayDate = new Date(startDate);
                dayDate.setDate(startDate.getDate() + i);
                
                const dayElement = createDayElement(dayDate, monthDate);
                calendarGrid.appendChild(dayElement);
            }
            
            monthContainer.appendChild(monthHeader);
            monthContainer.appendChild(weekdays);
            monthContainer.appendChild(calendarGrid);
            
            return monthContainer;
        }

        function createDayElement(date, monthDate) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            
            if (date.getMonth() !== monthDate.getMonth()) {
                dayElement.classList.add('other-month');
            }
            
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }
            
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = date.getDate();
            dayElement.appendChild(dayNumber);
            
            const dateString = date.toISOString().split('T')[0];
            const dayEvents = getEventsForDate(dateString);
            
            dayEvents.forEach(eventInfo => {
                const eventElement = document.createElement('div');
                eventElement.className = `event ${eventInfo.event.type}`;
                
                let displayText = eventInfo.event.title;
                if (eventInfo.event.duration > 1) {
                    if (eventInfo.dayNumber === 1) {
                        displayText += ` (Day 1/${eventInfo.event.duration})`;
                    } else if (eventInfo.dayNumber === eventInfo.event.duration) {
                        displayText += ` (Final Day)`;
                    } else {
                        displayText += ` (Day ${eventInfo.dayNumber}/${eventInfo.event.duration})`;
                    }
                }
                
                eventElement.textContent = displayText;
                eventElement.title = `${eventInfo.event.title} - Day ${eventInfo.dayNumber} of ${eventInfo.event.duration}`;
                dayElement.appendChild(eventElement);
            });
            
            dayElement.addEventListener('click', () => {
                document.getElementById('eventDate').value = dateString;
            });
            
            return dayElement;
        }

        function getEventsForDate(dateString) {
            const targetDate = new Date(dateString);
            const eventsForDay = [];
            
            events.forEach(event => {
                const startDate = new Date(event.startDate);
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + event.duration - 1);
                
                if (targetDate >= startDate && targetDate <= endDate) {
                    const daysDiff = Math.floor((targetDate - startDate) / (1000 * 60 * 60 * 24));
                    eventsForDay.push({
                        event: event,
                        dayNumber: daysDiff + 1
                    });
                }
            });
            
            return eventsForDay;
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const startDate = document.getElementById('eventDate').value;
            const duration = parseInt(document.getElementById('eventDuration').value);
            const type = document.getElementById('eventType').value;
            
            if (!title || !startDate) {
                alert('Please fill in both title and start date');
                return;
            }
            
            const newEvent = {
                title,
                startDate,
                duration,
                type
            };
            
            events.push(newEvent);
            events.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            clearForm();
            renderCalendar();
        }

        function clearForm() {
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventDuration').value = '1';
            document.getElementById('eventType').value = 'meet';
        }

        function renderUpcomingEvents() {
            const upcomingEvents = document.getElementById('upcomingEvents');
            const todayString = today.toISOString().split('T')[0];
            
            const futureEvents = events
                .filter(event => event.startDate >= todayString)
                .slice(0, 5);
            
            upcomingEvents.innerHTML = '';
            
            if (futureEvents.length === 0) {
                upcomingEvents.innerHTML = '<li style="color: #666; font-style: italic;">No upcoming events scheduled. Add events using the form above.</li>';
                return;
            }
            
            futureEvents.forEach(event => {
                const eventItem = document.createElement('li');
                eventItem.className = `event-item ${event.type}`;
                
                const startDate = new Date(event.startDate);
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + event.duration - 1);
                
                let dateString;
                if (event.duration === 1) {
                    dateString = startDate.toLocaleDateString('en-US', { 
                        weekday: 'short', 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                } else {
                    const startStr = startDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    const endStr = endDate.toLocaleDateString('en-US', { 
                        weekday: 'short',
                        year: 'numeric',
                        month: 'short', 
                        day: 'numeric' 
                    });
                    dateString = `${startStr} - ${endStr} (${event.duration} days)`;
                }
                
                eventItem.innerHTML = `
                    <div class="event-date">${dateString}</div>
                    <div class="event-title">${event.title}</div>
                `;
                
                upcomingEvents.appendChild(eventItem);
            });
        }

        // Food Recommendation Functions
        const ageSpecificNutrition = {
            'training-1': {
                name: 'Training Phase 1 (14-8 Days Out)',
                notes: 'Build glycogen but keep variety in your nutrition approach',
                '10-under': { carbs: '50%', protein: '18%', veggies: '17%', fruits: '15%' },
                '11-12': { carbs: '50%', protein: '20%', veggies: '15%', fruits: '15%' },
                '13-14': { carbs: '50%', protein: '22%', veggies: '15%', fruits: '13%' },
                '15-over': { carbs: '50%', protein: '25%', veggies: '15%', fruits: '10%' }
            },
            'training-2': {
                name: 'Training Phase 2 (7-3 Days Out)',
                notes: 'Taper training and begin glycogen loading protocol',
                '10-under': { carbs: '55%', protein: '17%', veggies: '13%', fruits: '15%' },
                '11-12': { carbs: '58%', protein: '18%', veggies: '12%', fruits: '12%' },
                '13-14': { carbs: '60%', protein: '18%', veggies: '12%', fruits: '10%' },
                '15-over': { carbs: '62%', protein: '18%', veggies: '10%', fruits: '10%' }
            },
            'carb-loading': {
                name: 'Carb Loading (2-1 Days Out)',
                notes: 'Begin fiber-reduction and low-residue foods, maintain hydration',
                '10-under': { carbs: '62%', protein: '18%', veggies: '10%', fruits: '10%' },
                '11-12': { carbs: '64%', protein: '17%', veggies: '10%', fruits: '9%' },
                '13-14': { carbs: '65%', protein: '16%', veggies: '9%', fruits: '10%' },
                '15-over': { carbs: '66%', protein: '16%', veggies: '8%', fruits: '10%' }
            },
            'competition': {
                name: 'Competition Day (Race Day)', 
                notes: 'Fast-fuel, easy-digest foods only. Small frequent portions',
                '10-under': { carbs: '67%', protein: '15%', veggies: '8%', fruits: '10%' },
                '11-12': { carbs: '68%', protein: '15%', veggies: '7%', fruits: '10%' },
                '13-14': { carbs: '69%', protein: '15%', veggies: '6%', fruits: '10%' },
                '15-over': { carbs: '70%', protein: '15%', veggies: '5%', fruits: '10%' }
            },
            'recovery': {
                name: 'Recovery (1-2 Days Post)',
                notes: 'Replenish glycogen and support muscle recovery',
                '10-under': { carbs: '50%', protein: '18%', veggies: '17%', fruits: '15%' },
                '11-12': { carbs: '50%', protein: '20%', veggies: '15%', fruits: '15%' },
                '13-14': { carbs: '50%', protein: '22%', veggies: '15%', fruits: '13%' },
                '15-over': { carbs: '50%', protein: '25%', veggies: '15%', fruits: '10%' }
            }
        };

        const foodDatabase = {
            protein: [
                { name: "Chicken Breast", emoji: "🐔", benefits: ["Complete protein", "Lean muscle building", "Easy to digest"], diets: ["regular", "paleo"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Turkey Breast", emoji: "🦃", benefits: ["High protein", "Low fat", "B vitamins"], diets: ["regular", "paleo"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Salmon", emoji: "🐟", benefits: ["Omega-3 fatty acids", "Anti-inflammatory", "Complete protein"], diets: ["regular", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "limit", recovery: "choose" }},
                { name: "Greek Yogurt", emoji: "🥛", benefits: ["Probiotics", "Quick absorption", "Calcium"], diets: ["regular", "vegetarian", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Eggs", emoji: "🥚", benefits: ["Complete amino acids", "Versatile", "Choline"], diets: ["regular", "vegetarian", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ],
            carbohydrates: [
                { name: "Brown Rice", emoji: "🍚", benefits: ["Complex carbs", "B vitamins", "Sustained energy"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Sweet Potatoes", emoji: "🍠", benefits: ["Beta carotene", "Complex carbs", "Potassium"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Oats", emoji: "🥣", benefits: ["Beta glucan", "Fiber", "Sustained energy"], diets: ["regular", "vegetarian", "vegan", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Bananas", emoji: "🍌", benefits: ["Quick energy", "Potassium", "Easy to digest"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ],
            "vegetables-high-fiber": [
                { name: "Broccoli", emoji: "🥦", benefits: ["Vitamin C", "Fiber", "Antioxidants"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }},
                { name: "Spinach", emoji: "🍃", benefits: ["Iron", "Folate", "Nitrates"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "limit", "competition": "avoid", recovery: "choose" }}
            ],
            "vegetables-low-fiber": [
                { name: "Tomatoes", emoji: "🍅", benefits: ["Lycopene", "Vitamin C", "Hydrating"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Cucumbers", emoji: "🥒", benefits: ["Hydrating", "Low calorie", "Refreshing"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ],
            fruits: [
                { name: "Oranges", emoji: "🍊", benefits: ["Vitamin C", "Hydrating", "Natural sugars"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }},
                { name: "Watermelon", emoji: "🍉", benefits: ["Hydrating", "Quick sugars", "Refreshing"], diets: ["regular", "vegetarian", "vegan", "paleo", "pescatarian"], phases: { "training-1": "choose", "training-2": "choose", "carb-loading": "choose", "competition": "choose", recovery: "choose" }}
            ]
        };

        function setupEventListeners() {
            document.getElementById('ageGroup').addEventListener('change', function() {
                currentAgeGroup = this.value;
                updateNutritionBreakdown();
            });

            document.getElementById('gender').addEventListener('change', function() {
                updateNutritionBreakdown();
            });

            document.querySelectorAll('input[name="weightUnit"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updateWeightInputLimits();
                    calculateBMI();
                    updateNutritionBreakdown();
                });
            });

            document.getElementById('weightInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.querySelectorAll('input[name="heightUnit"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    toggleHeightInputs();
                    calculateBMI();
                    updateNutritionBreakdown();
                });
            });

            document.getElementById('heightCmInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('heightFtInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('heightInInput').addEventListener('input', function() {
                calculateBMI();
                updateNutritionBreakdown();
            });

            document.getElementById('competitionDate').addEventListener('change', function() {
                updateNutritionBreakdown();
            });

            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPhase = this.dataset.phase;
                    updateNutritionBreakdown();
                    renderFoods();
                });
            });

            document.getElementById('categoryFilter').addEventListener('change', function() {
                currentCategory = this.value;
                renderFoods();
            });

            document.getElementById('dietFilter').addEventListener('change', function() {
                currentDiet = this.value;
                renderFoods();
            });

            document.getElementById('recommendationFilter').addEventListener('change', function() {
                currentRecommendation = this.value;
                renderFoods();
            });

            document.getElementById('searchInput').addEventListener('input', function() {
                searchTerm = this.value.toLowerCase();
                renderFoods();
            });
        }

        function updateWeightInputLimits() {
            const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
            const weightInput = document.getElementById('weightInput');
            
            if (weightUnit === 'kg') {
                weightInput.min = 20;
                weightInput.max = 150;
                weightInput.placeholder = 'Enter weight in kg';
            } else {
                weightInput.min = 44;
                weightInput.max = 330;
                weightInput.placeholder = 'Enter weight in lb';
            }
        }

        function toggleHeightInputs() {
            const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
            const cmInput = document.getElementById('heightCmInput');
            const ftInInputs = document.getElementById('heightFtInInputs');

            if (heightUnit === 'cm') {
                cmInput.style.display = 'block';
                ftInInputs.style.display = 'none';
            } else {
                cmInput.style.display = 'none';
                ftInInputs.style.display = 'flex';
            }
        }

        function getHeightInCm() {
            const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
            
            if (heightUnit === 'cm') {
                return parseFloat(document.getElementById('heightCmInput').value) || 0;
            } else {
                const ft = parseFloat(document.getElementById('heightFtInput').value) || 0;
                const inches = parseFloat(document.getElementById('heightInInput').value) || 0;
                const totalInches = (ft * 12) + inches;
                return totalInches * 2.54;
            }
        }

        function getWeightInKg() {
            const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
            const weight = parseFloat(document.getElementById('weightInput').value) || 0;
            
            if (weightUnit === 'kg') {
                return weight;
            } else {
                return weight * 0.453592;
            }
        }

        function calculateBMI() {
            const heightCm = getHeightInCm();
            const weightKg = getWeightInKg();
            
            if (heightCm > 0 && weightKg > 0) {
                const heightM = heightCm / 100;
                const bmi = weightKg / (heightM * heightM);
                
                document.getElementById('bmiResult').value = bmi.toFixed(1);
                return bmi;
            } else {
                document.getElementById('bmiResult').value = '';
                return null;
            }
        }

        function updateNutritionBreakdown() {
            const phaseData = ageSpecificNutrition[currentPhase];
            const ageData = phaseData[currentAgeGroup];
            
            document.getElementById('currentPhaseName').textContent = phaseData.name;
            document.getElementById('carbsPercent').textContent = ageData.carbs;
            document.getElementById('proteinPercent').textContent = ageData.protein;
            document.getElementById('veggiesPercent').textContent = ageData.veggies;
            document.getElementById('fruitsPercent').textContent = ageData.fruits;
            document.getElementById('phaseNotes').textContent = phaseData.notes;

            updatePersonalizedHeader();

            const weightKg = getWeightInKg();
            if (weightKg > 0) {
                updateWeightBasedRecommendations(weightKg, ageData);
            }
        }

        function updatePersonalizedHeader() {
            const ageGroup = document.getElementById('ageGroup').value;
            const gender = document.getElementById('gender').value;
            const weightValue = document.getElementById('weightInput').value;
            const heightCm = getHeightInCm();
            const bmi = calculateBMI();
            
            const ageGroupNames = {
                '10-under': '10 & Under',
                '11-12': 'AG 11-12',
                '13-14': 'AG 13-14', 
                '15-over': 'AG 15 & Over'
            };

            if (weightValue && heightCm > 0) {
                const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
                const heightUnit = document.querySelector('input[name="heightUnit"]:checked').value;
                
                let heightDisplay = '';
                if (heightUnit === 'ft-in') {
                    const ft = document.getElementById('heightFtInput').value;
                    const inches = document.getElementById('heightInInput').value;
                    heightDisplay = `${ft}'${inches}"`;
                } else {
                    heightDisplay = `${Math.round(heightCm)}cm`;
                }

                const headerText = `${ageGroupNames[ageGroup]} ${gender.charAt(0).toUpperCase() + gender.slice(1)} • ${weightValue}${weightUnit} • ${heightDisplay} • BMI: ${bmi ? bmi.toFixed(1) : '--'}`;
                document.getElementById('swimmerInfo').textContent = headerText;
                document.getElementById('personalizedHeader').style.display = 'block';
            } else if (weightValue) {
                const weightUnit = document.querySelector('input[name="weightUnit"]:checked').value;
                const headerText = `${ageGroupNames[ageGroup]} ${gender.charAt(0).toUpperCase() + gender.slice(1)} • ${weightValue}${weightUnit}`;
                document.getElementById('swimmerInfo').textContent = headerText;
                document.getElementById('personalizedHeader').style.display = 'block';
            } else {
                document.getElementById('personalizedHeader').style.display = 'none';
            }
        }

        function updateWeightBasedRecommendations(weightKg, ageData) {
            const carbsPercent = parseInt(ageData.carbs);
            
            const minCarbsLoading = Math.round(weightKg * 8);
            const maxCarbsLoading = Math.round(weightKg * 12);
            
            const minCarbsMorning = Math.round(weightKg * 1);
            const maxCarbsMorning = Math.round(weightKg * 4);

            let personalizedNotes = ageSpecificNutrition[currentPhase].notes;
            
            if (currentPhase === 'carb-loading' || currentPhase === 'training-2') {
                personalizedNotes += ` | Target: ${minCarbsLoading}-${maxCarbsLoading}g carbs daily`;
            } else if (currentPhase === 'competition') {
                personalizedNotes += ` | Pre-race meal: ${minCarbsMorning}-${maxCarbsMorning}g carbs`;
            }
            
            document.getElementById('phaseNotes').textContent = personalizedNotes;
        }

        function renderFoods() {
            const foodGrid = document.getElementById('foodGrid');
            const noResults = document.getElementById('noResults');
            const foodsToAvoid = document.getElementById('foodsToAvoid');
            let allFoods = [];

            for (const [category, foods] of Object.entries(foodDatabase)) {
                if (currentCategory === 'all' || currentCategory === category) {
                    foods.forEach(food => {
                        const recommendation = food.phases[currentPhase];
                        
                        const isDietCompatible = currentDiet === 'all' || food.diets.includes(currentDiet);
                        
                        if ((currentRecommendation === 'all' || currentRecommendation === recommendation) &&
                            isDietCompatible &&
                            (!searchTerm || food.name.toLowerCase().includes(searchTerm))) {
                            allFoods.push({
                                ...food,
                                category: category,
                                recommendation: recommendation
                            });
                        }
                    });
                }
            }

            const shouldShowAvoidSection = (currentPhase === 'carb-loading' || currentPhase === 'competition' || currentPhase === 'recovery') && 
                                         (currentRecommendation === 'all' || currentRecommendation === 'avoid');
            
            if (shouldShowAvoidSection) {
                foodsToAvoid.style.display = 'block';
                updateAvoidFoodsForPhase();
            } else {
                foodsToAvoid.style.display = 'none';
            }

            if (allFoods.length === 0 && !shouldShowAvoidSection) {
                foodGrid.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            foodGrid.style.display = 'grid';
            noResults.style.display = 'none';

            const sortOrder = { choose: 0, limit: 1, avoid: 2 };
            allFoods.sort((a, b) => sortOrder[a.recommendation] - sortOrder[b.recommendation]);

            foodGrid.innerHTML = allFoods.map(food => `
                <div class="food-card">
                    <div class="food-image">
                        ${food.emoji}
                    </div>
                    <div class="food-content">
                        <div class="food-name">${food.name}</div>
                        <div class="food-category">${formatCategory(food.category)}</div>
                        <div class="recommendation-badge ${food.recommendation}">
                            ${formatRecommendation(food.recommendation)}
                        </div>
                        <div class="diet-compatibility">
                            <small>${currentDiet === 'all' 
                                ? `Diet-friendly: ${food.diets.map(diet => diet.charAt(0).toUpperCase() + diet.slice(1)).join(', ')}`
                                : `✓ ${currentDiet.charAt(0).toUpperCase() + currentDiet.slice(1)} approved`
                            }</small>
                        </div>
                        <ul class="food-benefits">
                            ${food.benefits.map(benefit => `<li>${benefit}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        function updateAvoidFoodsForPhase() {
            const avoidGrid = document.querySelector('.avoid-food-grid');
            const subtitle = document.querySelector('.avoid-subtitle');
            
            if (currentPhase === 'recovery') {
                subtitle.textContent = 'These foods can hinder recovery and should be avoided after competition to optimize muscle repair and rehydration.';
                
                avoidGrid.innerHTML = `
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍗</div>
                        <div class="food-content">
                            <div class="food-name">Fried Chicken</div>
                            <div class="food-category">Deep-Fried Foods</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>High saturated fats</li>
                                <li>Slows digestion</li>
                                <li>Delays nutrient absorption</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍺</div>
                        <div class="food-content">
                            <div class="food-name">Alcohol</div>
                            <div class="food-category">Alcohol</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Impairs muscle recovery</li>
                                <li>Disrupts sleep quality</li>
                                <li>Affects hydration</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else {
                subtitle.textContent = 'These foods can negatively impact your performance and should be avoided during carb loading and competition phases.';
                
                avoidGrid.innerHTML = `
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍟</div>
                        <div class="food-content">
                            <div class="food-name">French Fries</div>
                            <div class="food-category">High-Fat Fried Foods</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Slows digestion</li>
                                <li>Causes bloating</li>
                                <li>Heavy feeling in water</li>
                            </ul>
                        </div>
                    </div>
                    <div class="food-card avoid-card">
                        <div class="food-image avoid-image">🍩</div>
                        <div class="food-content">
                            <div class="food-name">Donuts</div>
                            <div class="food-category">Sugary Desserts</div>
                            <div class="recommendation-badge avoid">Avoid</div>
                            <ul class="food-benefits avoid-effects">
                                <li>Sugar spike & crash</li>
                                <li>High trans fats</li>
                                <li>Energy instability</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        function formatCategory(category) {
            return category.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function formatRecommendation(rec) {
            switch(rec) {
                case 'choose': return 'Recommended';
                case 'limit': return 'Limit';
                case 'avoid': return 'Avoid';
                default: return rec;
            }
        }

        // Performance Tracking Functions
        function debugLog(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function toggleDebugMode() {
            debugMode = !debugMode;
            console.log('Debug mode:', debugMode ? 'enabled' : 'disabled');
        }

        function testConnection() {
            console.log('Testing connection...');
        }

        function showManualEntry() {
            console.log('Manual entry mode');
        }

        function testWithSampleUrl() {
            console.log('Testing with sample URL...');
        }

        function quickDiagnostic() {
            console.log('Running quick diagnostic...');
        }

        function showMeetScraper() {
            console.log('Meet scraper feature');
        }

        function validateUrl() {
            const url = document.getElementById('swimcloudUrl').value.trim();
            const validation = document.getElementById('urlValidation');
            
            if (!url) {
                validation.innerHTML = '';
                return;
            }
            
            const swimmerIdMatch = url.match(/swimmer\/(\d+)/);
            
            if (url.includes('swimcloud.com') && swimmerIdMatch) {
                validation.innerHTML = `<span style="color: #10b981; font-size: 0.8rem;">✅ Valid SwimCloud URL - Swimmer ID: ${swimmerIdMatch[1]}</span>`;
            } else if (url.includes('swimcloud.com')) {
                validation.innerHTML = `<span style="color: #f59e0b; font-size: 0.8rem;">⚠️ SwimCloud URL but missing swimmer ID</span>`;
            } else {
                validation.innerHTML = `<span style="color: #ef4444; font-size: 0.8rem;">❌ Not a SwimCloud URL</span>`;
            }
        }

        function loadSwimmerData() {
            console.log('Loading swimmer data...');
        }

        function loadMeetResults() {
            console.log('Loading meet results...');
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            toggleHeightInputs();
            updateWeightInputLimits();
            updateNutritionBreakdown();
            renderFoods();
            
            // Set a default date 3 weeks from now for nutrition plans
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 21);
            document.getElementById('targetMeetDate').value = defaultDate.toISOString().split('T')[0];
            document.getElementById('competitionName').value = 'Regional Championships';
            
            // Auto-generate the nutrition plan for demonstration
            setTimeout(() => {
                generateNutritionPlan();
            }, 500);
        });
    </script>
</body>
</html>
